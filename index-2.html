<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is Pengyin Shan's Note">
<meta name="viewport" content="width=device-width">
<title>Pengyin's Note (old posts, page 2) | Pengyin's Note</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://pengyin-shan.com/index-2.html">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><style>
    div.input_prompt {
      display: none;
    }
    </style>
</head>
<body>
    <section class="social"><ul>
<li><a href="index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://www.linkedin.com/in/pengyinshan" title="My LinkedIn"><i class="icon-linkedin"></i></a></li>
            <li><a href="https://github.com/shanpy" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
        <div class="post">
            <h1 class="title"><a href="posts/2015/Front%20End/bootstrap3-tricks.html">Bootstrap3 Tips CONTINUALLY UPDATE</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2015/Front%20End/bootstrap3-tricks.html#disqus_thread" data-disqus-identifier="cache/posts/2015/Front End/bootstrap3-tricks.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/bootstrap3.html" rel="tag">Bootstrap3</a></li>
           <li><a class="tag p-category" href="categories/css.html" rel="tag">CSS</a></li>
           <li><a class="tag p-category" href="categories/javascript.html" rel="tag">JavaScript</a></li>
           <li><a class="tag p-category" href="categories/jquery.html" rel="tag">jQuery</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014. This blog will be <strong>updating continually</strong>.</p>
<p>If you want to find specific topic, feel free to use <code>ctrl + F</code> to search for keyword.</p>
<h2>Change Glyphicon when Bootstrap Collapse Show or Hide</h2>
<p>This is what I learned from: http://stackoverflow.com/questions/18325779/bootstrap-3-collapse-show-state-with-chevron-icon . The answer is from <code>zessx</code>.</p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"panel-heading"</span> <span class="na">role</span><span class="o">=</span><span class="s">"tab"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">"collapsed"</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">"collapse"</span> <span class="na">data-parent</span><span class="o">=</span><span class="s">"#accordion"</span> <span class="na">href</span><span class="o">=</span><span class="s">"#test"</span> <span class="na">aria-expanede</span><span class="o">=</span><span class="s">"true"</span> <span class="na">aria-controls</span><span class="o">=</span><span class="s">"test"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"glyphicon glyphicon-plus"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        Here, when a panel is collapsed, a glyphicon-plus will appear.
        When it is toggled (i.e, change to a different state, which is not collapsed), a glyphicon-minus will appear.
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">toggleChevron</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">'.panel-heading'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'span'</span><span class="p">)</span> <span class="c1">//find elements that has tage 'span'</span>
        <span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">'glyphicon glyphicon-minus glyphicon-plus'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'#accordion'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'hidden.bs.collapse'</span><span class="p">,</span> <span class="nx">toggleChevron</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'#accordion'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'shown.bs.collapse'</span><span class="p">,</span> <span class="nx">toggleChevron</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre>


<h2>Collapse Panel Hide or Show</h2>
<p><code>hide</code>: will hide panel</p>
<p><code>show</code>: will show panel</p>
<p><code>toggle</code>: will change to opposite status</p>
<p>To use this, try <code>$('.class_name').collapse('toggle');</code> or <code>$('#id_name').collapse('hide')</code>.</p>
<h2>Sticky Header/Footer</h2>
<p>Bootstrap has two classes: <code>navbar-fixed-top</code> and <code>navbar-fixed-bottom</code> that can be served as sticky header and footer. Make sure add <code>body{ padding-top: 50px;}</code> or <code>body{ padding-bottom: 50px;}</code> when you use them.</p>
<blockquote>
<p>Note: the default height for navbar in Bootstrap3 is 50px high.</p>
</blockquote>
<h2>Dynamically Edit Checkbox</h2>
<h3>Default Status</h3>
<p>In Bootstrap3, when you add a simple check box, the default code is <code>&lt;input type="checkbox" /&gt;</code>.</p>
<p>This checkbox will keep un-checked. When you check it, this default code will keep the same.</p>
<p>If you use <code>this.getAttribute('checked')</code> to check if checkbox is checked or not, you always get <code>undefined</code>.</p>
<h3>Default Checked Status</h3>
<p>In Bootstrap3, you can set a default <code>checked</code> attribute to checkbox to make it default checked: <code>&lt;input type='checkbox' checked/&gt;</code>.</p>
<p>If you use <code>$(this).attr('checked')</code> to check status, it will return <code>checked</code> or <code>undefined</code>. But if you use <code>this.getAttribute("checked")</code>, you will always get <code>empty</code> value returned.</p>
<p>If you use <code>&lt;input type='checkbox' checked = "checked"/&gt;</code>, <code>$(this).attr('checked')</code> will return same result as above, but <code>this.getAttribute("checked")</code> will always get <code>checked</code> no matter if you check it or not.</p>
<p>You can also set <code>&lt;input type='checkbox' checked="checked"/&gt;</code> to make it default checked.</p>
<h3>Change Status</h3>
<p>Following JQuery Code can divide status of checkbox if someone check or uncheck it:</p>
<pre class="code literal-block"><span></span><span class="nx">$document</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="c1">//You should change 'type=checkbox' based on your code. 'name' can be skipped</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'[type=checkbox][name='</span><span class="nx">checkbox_name</span><span class="s1">']'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="kd">function</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">)</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"checked"</span><span class="p">,</span> <span class="s2">"checked"</span><span class="p">);</span>
            <span class="c1">//steps for a checked checkbox...</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"checked"</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
            <span class="c1">//steps for an un-checked checkbox...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>


<p>The usage of code above: when you check the checkbox, this default code will become <code>&lt;input type='checkbox' checked='checked'&gt;</code>. If you un-check it, code will change back to <code>&lt;input type="checkbox" /&gt;</code>.</p>
<p>In this case, if you use <code>$(this).attr(checked)</code> or <code>this.getAttribute(</code>checked<code>)</code> to check the status of checkbox, the <em>un-checked</em> checkbox will return <code>undefined</code>. the <em>checked</em> checkbox will return <code>checked</code>.</p>
<h3>Check/UnCheck Checkbox Using JavaScirpt</h3>
<p>In Bootstrap3, you can also set the <code>checked</code> attribute of checkbox to <code>true</code> or <code>false</code>.</p>
<p>If you use JQuery, <code>$(this).attr("checked",false)</code> will remove <code>checked</code> attribute in code.</p>
<p>If you use pure JavaScript, You have two steps to do this:</p>
<ul>
<li>
<p><code>this.setAttribute("checked", true)</code> or <code>this.setAttribute("checked", "checked")</code> can change the <em>code</em> but not <em>behavior</em>. i.e. code will become <code>&lt;input type='checkbox' checked='checked'&gt;</code> or <code>&lt;input type='checkbox' checked='true'&gt;</code>, but on user interface, checkbox is not checked</p>
</li>
<li>
<p><code>this.checked="checked"</code> or <code>this.checked = true</code> will only change use interface. Your checkbox will be checked buy there is nothing changed in code.</p>
</li>
</ul>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/use-java-to-get-clients-ip-address.html">Use Java to Get Client's IP Address</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/use-java-to-get-clients-ip-address.html#disqus_thread" data-disqus-identifier="cache/posts/2014/use-java-to-get-clients-ip-address.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>I found a very useful StackOverflow post, which is about getting client's ip address using java. <em>Note: JavaScript itself is unable to do this. However, there are seveal website providng API that you can make ajax call to it.</em></p>
<p>From <a href="http://stackoverflow.com/users/356815/baszero">basZero</a>, a complate way is:</p>
<pre class="code literal-block"><span></span><span class="n">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-Forwarded-For"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Proxy-Client-IP"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"WL-Proxy-Client-IP"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_X_FORWARDED_FOR"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_X_FORWARDED"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_X_CLUSTER_CLIENT_IP"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_CLIENT_IP"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_FORWARDED_FOR"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_FORWARDED"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"HTTP_VIA"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"REMOTE_ADDR"</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
</pre>


<p>When I test it, I found everything returns 'null' except the last one, <code>request.getRemoteAddr()</code>, gave the right IP address.</p>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/use-google-custom-search-in-your-website.html">Use Google Custom Search In Your Website</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/use-google-custom-search-in-your-website.html#disqus_thread" data-disqus-identifier="cache/posts/2014/use-google-custom-search-in-your-website.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/google.html" rel="tag">Google</a></li>
           <li><a class="tag p-category" href="categories/web-developement-tips.html" rel="tag">Web Developement Tips</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p _="%" images_posts_google_cse.png="images/posts/google_cse.PNG" img>You need a google account to use Google Custom Search Engine. Go to "www.google.com/cse" and sign in with your Google account.</p>
<p _="%" images_posts_google_cse_create.png="images/posts/google_cse_create.PNG" img>In the console, click "New search engine" on left menu, then input the website url you want to search from. You also need a name for this new search engine. After finsih setup, click "CREATE" button.</p>
<p _="%" images_posts_google_cse_id.png="images/posts/google_cse_id.PNG" img>You need to use <code>Search Engine ID</code> for creating RESTful service. To do this, select "Edit search engine" on left menu. In the dropdown, select your search engine. Select "Basics" panel on right, then click "Search engine ID" in details part. A pop up box will appears with your Search Engine ID.</p>
<p>You also need your api key for creating RESTful service. To do this, you need a project and get its API key in <em>Google Developers Console</em>. You can do this by log in "console.developers.google.com" and select "Credentials" in "APIs &amp; auth" menu. You will see API key appearing on right panel.</p>
<p>Then go back to your Custom Search panel. In "Details" part on right, click "Get Code" button (just near "Search Engine ID" button). Copy the code on this page and paste it into a '</p>
<div>' where you want the Google search bar appears.
<p>You may want to use RESTful api to get results from Google custom search engine. The format of requested url is: <code>https://www.googleapis.com/customsearch/v1?key=XXX&amp;cx=XXX&amp;q=XXX</code>. You should put your API key as <code>key</code> parameter, your search engine Id as <code>cx</code> paramter, and the string your want to search as <code>q</code> parameter.</p>
<p>You can also add query parameters at the end of request url, such as <code>&amp;callback=</code> for returning <code>JSON-P</code> object. Please refer to "https://developers.google.com/custom-search/json-api/v1/using_rest" if you need</p>
<p>Here is an example using AngularJS:</p>
<pre class="code literal-block"><span></span><span class="c1">//We want to search "javascript" using Custom Search Engine</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'https://www.googleapis.com/customsearch/v1?key=XXX&amp;cx=XXX&amp;q=javascript&amp;callback=JSON_CALLBACK'</span><span class="p">;</span>
        <span class="nx">$http</span><span class="p">.</span><span class="nx">jsonp</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">headers</span><span class="p">,</span> <span class="nx">config</span><span class="p">){</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"callback"</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;br/&gt;"</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">htmlTitle</span><span class="p">;</span>
                <span class="c1">//This will return all searchign result's title</span>
              <span class="p">}</span>
        <span class="p">})</span>
       <span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">headers</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"error: "</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">" status: "</span> <span class="o">+</span> <span class="nx">status</span> <span class="o">+</span> <span class="s2">" headers: "</span> <span class="o">+</span> <span class="nx">headers</span> <span class="o">+</span> <span class="s2">" config: "</span> <span class="o">+</span> <span class="nx">config</span><span class="p">);</span>
        <span class="p">});</span>
</pre>
</div>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-22.html">Reading Notes for Spring 3 Core Components Tutorial Part VI (Chapter 22)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-22.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-22.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 22 in tutorial.</p>
<h2>Spring Web MVC Framework</h2>
<h3>The Dispacher Servlet</h3>
<p>{% img images/posts/dispatcher_servlet.png %}</p>
<h3>Required Configuration</h3>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--First: You set up dispacher servlet in web.xml--&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">id=</span><span class="s">"testWebApp"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;display-name&gt;</span>Test Web App<span class="nt">&lt;/display-name&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>TestServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="c">&lt;!--Since we define TestServelt as dispacther servlet here, Spring will now try to find a servlet called TestServlet-servlet.xml in WebContent/WEB-INF directory--&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="c">&lt;!--servlet-mapping here means all jsp files should be handled by TestServlet--&gt;</span>
    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>TestServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-patterm&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>

    <span class="c">&lt;!--You can also define your own servlet name instead of [servlet-name]-servelet.xml--&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>/WEB-INF/test-servlet<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!--make sure you add this listener if you want to define your own--&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoadListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--Now we create beans and set up ViewResolver, using [servlet-name]-servlet.xml--&gt;</span>
    <span class="nt">&lt;context:compont-scan</span> <span class="na">base-package=</span><span class="s">"com.sample"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--The line above means we want search Spring MVC Annotation such as @Controller or @RequestMapping in com.sample package--&gt;</span>

    <span class="c">&lt;!--We want to search for /WEB-INF/jsp folder to get .jsp files to resolve view names. For example, a logical view named hello should be a /WEB-INF/jsp/hellp.jsp--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.InternalResourceViewResolover"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"prefix"</span> <span class="na">value=</span><span class="s">"/WEB-INF/jsp"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"suffix"</span> <span class="na">value=</span><span class="s">".jsp"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<h3>Controller</h3>
<p>You need <code>@Controller</code> annotation to make a controller class, and use <code>@RequestMapping</code> to get path and define type of request.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testController</span><span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/test"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printHello</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="err">'</span><span class="n">message</span><span class="sc">','</span><span class="n">Hello</span> <span class="n">World</span><span class="o">!</span><span class="err">'</span><span class="o">);</span> <span class="c1">//Use ${message} in jsp file to get model attribute</span>
        <span class="k">return</span> <span class="s">"index"</span><span class="o">;</span> <span class="c1">//Return a view and string is the logical view name, which is defined in ViewResolver above</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Form Submmision Example</h3>
<p>HTML:</p>
<pre class="code literal-block"><span></span><span class="p">&lt;</span><span class="nt">form:form</span> <span class="na">method</span><span class="o">=</span><span class="s">"POST"</span> <span class="na">action</span><span class="o">=</span><span class="s">"/HelloWorld/Student"</span> <span class="na">modelAttribute</span><span class="o">=</span><span class="s">"Person"</span><span class="p">&gt;</span>
<span class="c">&lt;!--You can also do action="addStudent", which is corresponding controller--&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:label</span> <span class="na">path</span><span class="o">=</span><span class="s">"name"</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">form:label</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:input</span> <span class="na">path</span><span class="o">=</span><span class="s">"name"</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:label</span> <span class="na">path</span><span class="o">=</span><span class="s">"age"</span><span class="p">&gt;</span>Age<span class="p">&lt;/</span><span class="nt">form:label</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:input</span> <span class="na">path</span><span class="o">=</span><span class="s">"age"</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:label</span> <span class="na">path</span><span class="o">=</span><span class="s">"id"</span><span class="p">&gt;</span>Id<span class="p">&lt;/</span><span class="nt">form:label</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">form:input</span> <span class="na">path</span><span class="o">=</span><span class="s">"id"</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">"2"</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"commit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Submit"</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form:form</span><span class="p">&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we hava web.xml, testServlet-servlet.xml, Student.java as example above</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testController</span><span class="o">{</span>

    <span class="c1">//This step has other ways to implement it</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/student"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">student</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="s">"student"</span><span class="o">,</span><span class="s">"studentModel"</span><span class="o">,</span><span class="k">new</span> <span class="n">Student</span><span class="o">());</span>
        <span class="c1">//Here we first create a Student object and go to student view(i.e student.jsp).</span>
        <span class="c1">//Note "studentModel" is a model idetifier. Spring use it to recognize "&lt;form:form&gt;" value"</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/Student"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addStudent</span><span class="o">(</span><span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"studentModel"</span><span class="o">)</span><span class="n">Student</span> <span class="n">student</span><span class="o">,</span> <span class="n">ModalMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="c1">//Since we have set studentModel is a Student object, Spring get attributes from form, and set it to a Student object.</span>
        <span class="c1">//So now you can directly use student.getname();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">student</span><span class="o">.</span><span class="na">getname</span><span class="o">());</span>
        <span class="c1">//age, id is the same</span>

        <span class="k">return</span> <span class="s">"result"</span><span class="o">;</span> <span class="c1">//Now you can use ${name}, ${age} and ${id} in result.jsp</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-21.html">Reading Notes for Spring 3 Core Components Tutorial Part VII (Chapter 21)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-21.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-21.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 21 in tutorial.</p>
<h2>Spring Transaction Management</h2>
<p>A <strong>Database Transaction</strong> is a sequence of actions that are treated as a single unit of work. <em>You either run all of actions once, or you don't run any of them</em>.</p>
<h3>Four Properties About Database**</h3>
<p>There are four key property that a transaction must have, called <strong>ACID</strong>:</p>
<ul>
<li>
<p><code>Atomicity</code>: A transaction must be treated as <em>a single unit of operation</em>, which means either the entire sequence of operations is <em>successful</em> or <em>unsuccessful</em>.</p>
</li>
<li>
<p><code>Consistency</code>: This represents the consistency of the referential integrity of the database, unique primary keys in tables etc. <em>All the rules must be applied for transactions, so that all data is complete.</em> For example, all B-Tree index or double-linked list must be right after a transaction.</p>
</li>
<li>
<p><code>Isolation</code>: There may be <em>many</em> transactions processing with the <em>same</em> data set at the <em>same</em> time, each transaction should be <em>isolated</em> from others to prevent the data corruption.</p>
</li>
<li>
<p><code>Durability</code>: Once a transaction has completed, the results of this transaction has to be <em>permanent</em> and <em>cannot be earased from the database</em> due to system failure.</p>
</li>
</ul>
<h3>A Typical Sequence of Transaction</h3>
<p>Begin the transaction using begining transaction command</p>
<p>Perfom <code>deleted</code>, <code>update</code> or <code>insert</code> operations using SQL queries.</p>
<p>If all the operation are successful then perfom <code>commit</code> otherwise <code>rollback</code> all the operations.</p>
<p>Spring transaction support aims to provide an alternative to <code>EJB</code> transactions by adding transaction capabilities to <code>POJO</code>s.</p>
<p>Spring supports both <code>programmatic</code> and <code>declarative</code> transaction management.</p>
<p>Spring transaction management can be implemented <em>without</em> a need of application server.</p>
<h3>Local vs Global Transactions</h3>
<p><code>Local Transaction</code> is specific to a <em>single</em> transaction resource such as a JDBC connection, whereas <code>Global Transactions</code> can span <em>multiple</em> transaction resources like transaction in a Distributed System.</p>
<p><code>Local Transaction</code> is useful in a centralized computing environment where application components and resources are located at <em>a single site</em> and transaction management only involves a <em>local data manager</em> runing on a <em>single machine</em>. Local transactions are easier to implement.</p>
<p><code>Global Transaction</code> management is required in a <em>distributed</em> computing environment where all the resources are distributed across <em>multiple systems</em>. In such a case transaction management needs to be done both <em>at local and global events</em>. A distributed or a global transaction is executed across multiple systems, and its execution requires <em>coordination</em> between the global transaction management system and all the local data managers of all the involved systems.</p>
<h3>Programmatic vs Declarative</h3>
<p>Spring supports two type of transaction management:</p>
<ul>
<li>
<p><code>Programmatic Transaction Management</code>: You manage the transaction with the help of programming. This ways has most <em>flexibility</em>, but it is <em>difficult to maintain</em>.</p>
</li>
<li>
<p><code>Declarative Transaction Management</code>: You <em>seperate</em> transaction management from the <em>business code</em>. You only use <code>xml</code> based configuration to manage transactions. This is more preferable. Spring supports declarative transaction management through the Spring AOP framework.</p>
</li>
</ul>
<h3>Spring Transaction Abstractions</h3>
<p _="%" images_posts_platformtransactionmanager.png="images/posts/PlatformTransactionManager.png" img>The key to Spring transaction is: <code>org.springframework.transaction.PlatformTransactionManager</code> interface.</p>
<p _="%" images_posts_transactiondefinition.png="images/posts/TransactionDefinition.png" img><code>TransactionDefinition</code> is the core interface of the transaction support in Spring.</p>
<p _="%" images_posts_transactionstatus.png="images/posts/TransactionStatus.png" img><code>TransactionStatus</code> interface is used to control transaction execution and query transaction status.</p>
<h3>Programmatic Transaction Management</h3>
<p>The generate process of <code>Programmatic Transaction Management</code> is:</p>
<ul>
<li>
<p>Use an instance of <code>TransactionDefinition</code> with appropriate transaction attributes to start a new transaction.</p>
</li>
<li>
<p>Start your transaction by calling <code>getTransaction()</code> method, which returns an instance of <code>TransactionStatus</code>.</p>
</li>
<li>
<p><code>TransactionStatus</code> objects helps in tracking the current status of transaction.</p>
</li>
<li>
<p>If everything goes fine, you can use <code>commit()</code> method of <code>PlatformTransactionManager</code> to commit the transaction, otherwise use <code>rollback()</code> to rollback the complate operation.</p>
</li>
</ul>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--Initialization for data source --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/TEST"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!--Initialization for TransactionManager --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DataSourceTransactionManger"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!--Defination of studentDaoImpl bean--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"studentDaoImpl"</span> <span class="na">class=</span><span class="s">"com.sample.StudentDaoImpl"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"transactionManager"</span> <span class="na">ref=</span><span class="s">"transactionManager"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we have a StudentDao interface, a student class with getters and setters, and a studentMapper class</span>
<span class="c1">//Assume we have a Student table and a Marks table</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentDaoImpl</span> <span class="kd">implements</span> <span class="n">StudentDao</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">DataSouce</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplateObject</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplateObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//Differnet from examples before, we need to set up TransactionManager</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTransactionManager</span><span class="o">(</span><span class="n">PlatformTransacionManager</span> <span class="n">tansactionManager</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">transactionManager</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">){</span>
        <span class="c1">//Start Transaction</span>
        <span class="n">TransactionDefination</span> <span class="n">def</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultTransactionDefinition</span><span class="o">();</span>
        <span class="n">TransactionStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="n">def</span><span class="o">);</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">SQL1</span> <span class="o">=</span> <span class="s">"insert into Student (name,age) values (?,?)"</span><span class="o">;</span>
            <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">SQL1</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>

            <span class="c1">//Get latest student id from student table</span>
            <span class="n">String</span> <span class="n">SQL2</span> <span class="o">=</span> <span class="s">"select max(id) from Student"</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">sid</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">queryForInt</span><span class="o">(</span><span class="n">SQL2</span><span class="o">);</span>

            <span class="n">String</span> <span class="n">SQL3</span> <span class="o">=</span> <span class="s">"insert into Marks(sid, marks, year) "</span> <span class="o">+</span> <span class="s">"values (?,?,?)"</span><span class="o">;</span>
            <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">udpate</span><span class="o">(</span><span class="n">SQL3</span><span class="o">,</span> <span class="n">sid</span><span class="o">,</span> <span class="n">marks</span><span class="o">,</span> <span class="n">year</span><span class="o">);</span>

            <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">status</span><span class="o">);</span> <span class="c1">//Make sure you commit after sql operation!</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">listStudents</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">SQL</span> <span class="o">=</span> <span class="s">"select * from Student, Marks where Student.id = Marks.sid"</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="n">students</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span> <span class="k">new</span> <span class="n">StudentMapper</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">students</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

    <span class="n">StudentDaoImpl</span> <span class="n">studetnDaoImpl</span> <span class="o">=</span> <span class="o">(</span><span class="n">StudentDaoImpl</span><span class="o">)</span><span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"studentDapImpl"</span><span class="o">);</span>
    <span class="c1">//Now you can dp studentDaoImpl.create(), etc.</span>
<span class="o">}</span>
</pre>


<h3>Declarative Transaction Management</h3>
<p>If you use <code>Declarative Transaction Management</code>, you only use <code>Annotations</code> or <code>XML</code> based configuration to manage the transactions. Steps are:</p>
<ul>
<li>
<p>Add <code>&lt;tx:advice /&gt;</code> tag in <code>XML</code> file, which creates a transaction-handling advice and ame time we define a <em>pointcut</em> that matches all methods we wish to make transactional and reference the transactional advice.</p>
</li>
<li>
<p>If a method name has been included in the transactional configuration then created advice will begin the transaction <em>before</em> calling the method.</p>
</li>
<li>
<p>Target method should be in a <code>Try/Catch</code> block.</p>
</li>
<li>
<p>If the method finishes normally, the AOP advice <code>commits</code> the transaction successfully otherwise it performs a <code>rollback</code>.</p>
</li>
</ul>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--Data Source Setup is the same as example above--&gt;</span>
<span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">"txAdivce"</span> <span class="na">transaction-manager=</span><span class="s">"transactionManager"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tx:attribute&gt;</span>
    <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">"create"</span><span class="nt">/&gt;</span> <span class="c">&lt;!--Transaction will begin before calling this method--&gt;</span>
    <span class="nt">&lt;/tx:attribute&gt;</span>
<span class="nt">&lt;/tx:advice&gt;</span>

<span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"createOperation"</span> <span class="na">express=</span><span class="s">"execution(*com.sample.StudentDaoImpl.create(...))"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">"txAdvice"</span> <span class="na">point-cut=</span><span class="s">"createOperation"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>
<span class="c">&lt;!--TransactionManager and StudentDaoImpl are the same as example above--&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we have a StudentDao interface, a student class with getters and setters, and a studentMapper class</span>
<span class="c1">//Assume we have a Student table and a Marks table</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentDaoImpl</span> <span class="kd">implements</span> <span class="n">StudentDao</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplateObject</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
        <span class="c1">//No need to declare dataSource in java class</span>
    <span class="o">}</span>
    <span class="c1">//No need to set up TransactionManager in java class</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">){</span>
        <span class="c1">//No need to set up Transaction</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">SQL1</span> <span class="o">=</span> <span class="s">"insert into Student (name,age) values (?,?)"</span><span class="o">;</span>
            <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">SQL1</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>

            <span class="c1">//Get latest student id from student table</span>
            <span class="n">String</span> <span class="n">SQL2</span> <span class="o">=</span> <span class="s">"select max(id) from Student"</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">sid</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">queryForInt</span><span class="o">(</span><span class="n">SQL2</span><span class="o">);</span>

            <span class="n">String</span> <span class="n">SQL3</span> <span class="o">=</span> <span class="s">"insert into Marks(sid, marks, year) "</span> <span class="o">+</span> <span class="s">"values (?,?,?)"</span><span class="o">;</span>
            <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">udpate</span><span class="o">(</span><span class="n">SQL3</span><span class="o">,</span> <span class="n">sid</span><span class="o">,</span> <span class="n">marks</span><span class="o">,</span> <span class="n">year</span><span class="o">);</span>

            <span class="c1">//No need to commit after sql operation!</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">listStudents</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">SQL</span> <span class="o">=</span> <span class="s">"select * from Student, Marks where Student.id = Marks.sid"</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="n">students</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span> <span class="k">new</span> <span class="n">StudentMapper</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">students</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

    <span class="n">StudentDaoImpl</span> <span class="n">studetnDaoImpl</span> <span class="o">=</span> <span class="o">(</span><span class="n">StudentDaoImpl</span><span class="o">)</span><span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"studentDapImpl"</span><span class="o">);</span>
    <span class="c1">//Now you can dp studentDaoImpl.create(), etc.</span>
<span class="o">}</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-20.html">Reading Notes for Spring 3 Core Components Tutorial Part V (Chapter 20)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-20.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-20.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 20 in tutorial.</p>
<h2>Spring JDBC Framework</h2>
<p>Spring JDBC Framework takes care of all the low-level details starting from opening the connection, prepare and execute the SQL statement, process exceptions, handing transactions and finally close the connection.</p>
<p><code>JDBCTemplate</code> is the most popular approach of using Spring JDBC framework.</p>
<h3>JDBC Template Class</h3>
<p>The <code>JdbcTemplate</code> class executes SQL queries, update statements and stored procedure calls, performs iteration over <code>ResultSets</code> and extraction of returned parameter values. It also catches <code>JDBC exceptions</code> and translates them to the generic, more informative, exception hierarchy defined in the <code>org.springframework.dao</code> package.</p>
<p>Since instance of <code>JdbcTemplate</code> classes are <em>threadsafe</em> once it is configured, you can just configure <em>one</em> instance of <code>JdbcTemplate</code>, then <em>inject</em> it to different <code>DAO</code>s.</p>
<p>A comment practice is to configure a <code>DataSource</code> in your spring configuration file, then <em>inject</em> that bean to your <code>DAO</code> classes. For example:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="nt">&gt;</span> <span class="c">&lt;!--MySQL here as an example --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/TEST"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--You need URL, username and password --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<h3>Executing SQL Statements</h3>
<p><code>DAO</code> means <code>Data Access Object</code>. DAO often implements an <code>interface</code>, which provides ablity to read/write data from database. Other parts of application access DAO.</p>
<p>The way to achieve CRUD(Create, Read, Update and Delete) operation is (Assume <code>SQL</code> ia a SQL statement):</p>
<p><em>Query</em>:</p>
<ul>
<li>
<p>Query for Integer: <code>jdbcTemplateObject.queryForInt(SQL);</code></p>
</li>
<li>
<p>Query for Long: <code>jdbcTemplateObject.queryForLong(SQL);</code></p>
</li>
<li>
<p>Query for Int, with a <em>bind variable</em>: <code>jdbcTemplateObject.queryForInt(SQL, new Object[]{10});</code></p>
</li>
<li>
<p>Query for String, with a <em>bind variable</em>: <code>jdbcTemplateObject.queryForInt(SQL, new Object[]{10}, String.class);</code></p>
</li>
<li>
<p>Query with <code>ObjectMapper</code>. This <code>ObejctMapper</code> will be returned after query finishes:</p>
</li>
</ul>
<blockquote>
<pre class="code literal-block"><span></span><span class="c1">//Assume we want a Studnet object being returned</span>
<span class="n">Student</span> <span class="n">student</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="mi">10</span><span class="o">},</span> <span class="k">new</span> <span class="n">StudentMapper</span><span class="o">());</span>
</pre>


</blockquote>
<pre class="code literal-block"><span></span>public class StudentMapper implements RowMapper&lt;student&gt;{
    public Student mapRow(ResultSet rs, int rowNum) throws SQLException{
        Student student = new Student();
        student.setName(rs.getSring("name"));
        student.setId(rs.getInt("id"));
        //Just apply these to setters
        return Student;
    }
}
</pre>


<ul>
<li>Query with <code>ObjectMapper</code>, return <em>multiple objects</em>:</li>
</ul>
<blockquote></blockquote>
<pre class="code literal-block"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="n">students</span> <span class="o">=</span> <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span><span class="k">new</span> <span class="n">StudentMapper</span><span class="o">());</span>
<span class="c1">//StudentMapper class is the same as example above</span>
</pre>


<p><em>Insert</em>: SQL Statement: <code>insert into Student(name,age) values (?,?)</code>. JDBCTemplate: <code>jdbcTemplateObject.update(SQL, new Object[]{"Tim", 11});</code>. If you want to insert more, just add more field and and key/value pair to SQL statement and JDBCTemplate.</p>
<p><em>Update</em>: SQL Statement: <code>update Student set name=? where id=?</code>. JDBCTemplate: <code>jdbcTemplateObject.update(SLQ, new Object[]{"Time",1});</code></p>
<p><em>Delete</em>: SQL Statement: <code>delete Student where id=?</code>. JDBCTemplate: <code>jdbcTemplateObject.update(SQL, new Object[]{10});</code></p>
<p><em>Create</em>: SQL Statement: <code>CREATE TABLE STUDENT(</code> + <code>ID  INT NOT NULL AUTO_INCREMENT</code>, etc. JDBCTemplate: <code>jdbcTemplateObject.execute(SQL);</code></p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="nt">&gt;</span> <span class="c">&lt;!--MySQL here as an example --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/TEST"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--You need URL, username and password --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"studentDAOImpl"</span> <span class="na">class=</span><span class="s">"com.sample.StudentDAOImpl"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"datSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we have a Student class with getter and setter for id, name and age attribute.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentMapper</span> <span class="kd">implements</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="n">Student</span> <span class="nf">mapRow</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span><span class="o">{</span>
        <span class="n">Student</span> <span class="n">student</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Student</span><span class="o">();</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getSring</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">Student</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">}</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">StudentDAO</span><span class="o">{</span>
    <span class="c1">//Initialize database resource. i.e. connection</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">ds</span><span class="o">);</span>

    <span class="c1">//Create Record</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">);</span>

    <span class="c1">//Get One Record from Id</span>
    <span class="kd">public</span> <span class="n">Student</span> <span class="nf">getStudent</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">//Get All Records</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">listStudents</span><span class="o">();</span>

    <span class="c1">//Delete A Record from Id</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)();</span>

    <span class="c1">//Update a Record from Id</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">)();</span>
<span class="o">}</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>

<span class="c1">//This class is the JDBCTemplate class, which is used to implement DAO interface above</span>

<span class="n">publc</span> <span class="kd">class</span> <span class="nc">StudentDAOImpl</span> <span class="kd">implements</span> <span class="n">StudentDAO</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span> <span class="c1">//we define this in beans.xml</span>
    <span class="kd">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplateObject</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplateObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">SQL</span> <span class="o">=</span> <span class="s">"insert into Student(name,age) values (?,?)"</span><span class="o">;</span>
        <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Student</span> <span class="nf">getStudent</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="c1">//Same as update example above</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">listStudents</span><span class="o">(){</span>
        <span class="c1">//Same as query example above</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)(){</span>
        <span class="c1">//Same as delete example above;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">)(){</span>
        <span class="c1">//Same as udpat example above;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">publc</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

        <span class="n">StudentDAOImpl</span> <span class="n">studentDaoImpl</span> <span class="o">=</span> <span class="o">(</span><span class="n">StudentDAOImpl</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBeans</span><span class="o">(</span><span class="s">"studentDAOImpl"</span><span class="o">);</span>
        <span class="c1">//Note we don't need to get dataSource bean. Spring does that automatically</span>

        <span class="n">studentDaoImpl</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Tim"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="c1">//You can now use DAO operation</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>There are other JDBC framework prepared by Spring, such as <code>NamedParameterJdbcTemplate</code> and <code>SimpleJdbcTemplate</code> classes.</p>
<h3>Stored Procedure</h3>
<p><code>SimpleJdbcCall</code> class is used to call a <em>stored procedure</em> with <code>IN</code> and <code>OUT</code> parameters.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.MapSqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcCall</span><span class="o">;</span>

<span class="c1">//bean.xml, Student.java, StudentMapper.java and StudentDAO.java are the same as example above</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentDAOImpl</span> <span class="kd">implements</span> <span class="n">StudentDAO</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">SimpleJdbcCall</span> <span class="n">jdbcCall</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcCall</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcCall</span><span class="o">(</span><span class="n">dataSource</span><span class="o">).</span><span class="na">withProcedureName</span><span class="o">(</span><span class="s">"Procedure_Name"</span><span class="o">);</span>
        <span class="c1">//This is the way to call the stored procedure</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">){</span>
        <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplateObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">SQL</span> <span class="o">=</span> <span class="s">"insert into Student (name,age) values (?,?)"</span><span class="o">;</span>
        <span class="c1">//Since we don't have a JdbcTemplate attribute now, we need to create new one here</span>
        <span class="n">jdbcTemplateObject</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">SQL</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Student</span> <span class="nf">getStudent</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">SqlParameterSource</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapSqlParameterSource</span><span class="o">().</span><span class="na">addValue</span><span class="o">(</span><span class="s">"in_id"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="c1">//Add value parameter for stored procedure</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">out</span> <span class="o">=</span> <span class="n">jdbcCall</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>

        <span class="n">Student</span> <span class="n">student</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Student</span><span class="o">();</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setName</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">out</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"out_name"</span><span class="o">));</span> <span class="c1">//Add stored procedure value to setter</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setAge</span><span class="o">((</span><span class="n">Integer</span><span class="o">)</span> <span class="n">out</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"out_age"</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">Student</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//listStudents() is the same as example above</span>
    <span class="c1">//Test class is the same as example above, and you should get same result</span>
<span class="o">}</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-17-to-19.html">Reading Notes for Spring 3 Core Components Tutorial Part I Part IV (Chapter 17 to Chapter 19)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-17-to-19.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-17-to-19.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 17 to Chapter 19 in tutorial.</p>
<h2>Chapter 17: Event Handling in Spring</h2>
<p>In Spring, the <code>ApplicatonContext</code> publishes certain types of <code>events</code> when loading the beans.</p>
<p><code>ApplicationEvent</code> class and <code>ApplicationListener</code> interface is used in <code>ApplicationContext</code> to deal with event handling.</p>
<p>If a bean implements <code>ApplicationListener</code>, then every time <code>ApplicatioContext</code> publish an <code>ApplicationEvent</code>, this bean will be notified.</p>
<p _="%" images_posts_spring_events.png="images/posts/spring_events.png" img>Spring Events are following:</p>
<p>Spring event handling is <em>single-threaded</em>. So if an event is published, unless all receivers get the message, the processes are <em>blocked</em> and the flow will not continue.</p>
<p>A bean can <em>implement</em> the <code>ApplicationListener</code> interface to listen a event. <code>ApplicationListener</code> only has one method, which is <code>onApplicationEvent()</code>.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"helloWorld"</span> <span class="na">class=</span><span class="s">"com.sample.HelloWorld"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">value=</span><span class="s">"Hello World!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"cStartEventHandler"</span> <span class="na">class=</span><span class="s">"com.sample.CStartEventHandler"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"cStopEventHandler"</span> <span class="na">class=</span><span class="s">"com.sample.CStopEventHandler"</span><span class="nt">/&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
        <span class="c1">//Assume we give message a setter and getter</span>
<span class="o">}</span>
<span class="c1">//This is a listener we defined for start an event. So we implements ContextStartedEvent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CStartEventHandler</span> <span class="kd">implements</span> <span class="n">ApplicationListener</span><span class="o">&lt;</span><span class="n">ContextStartedEvent</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onApplicationContext</span><span class="o">(</span><span class="n">ContextStartedEvent</span> <span class="n">event</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ContextStartedEvent Received"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//This is a listener we defined for stop an event. So we implements ContextStoppedEvent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CStopEventHandler</span> <span class="kd">implements</span> <span class="n">ApplicationListener</span><span class="o">&lt;</span><span class="n">ContextStoppedEvent</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onApplicationContext</span><span class="o">(</span><span class="n">ContextStartedEvent</span> <span class="n">event</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ContextStoppedEvent Received"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ConfigurableApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

        <span class="c1">//Start a event</span>
        <span class="n">context</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">HelloWorld</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>

        <span class="n">obj</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>

        <span class="c1">//Stop an event</span>
        <span class="n">context</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h2>Chapter 18: Custom Events in Spring**</h2>
<p>To create a custom event, you need a <code>event</code> class, a <code>event publisher</code> class and a <code>event handler</code> class:</p>
<p>XML:
    :::xml
    <bean id="customEventHanler" class="com.sample.CustomEventHandler"></bean><bean id="customEventListener" class="com.sample.CustomEventListener"></bean></p>
<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//To create a custom event, event class needs to extend ApplicationEvent</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomEvent</span> <span class="kd">extends</span> <span class="n">ApplicationContext</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nf">CustomEvent</span><span class="o">(</span><span class="n">Object</span> <span class="n">source</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"Custom Event"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//To create a custom event publisher, publisher class needs to implement ApplicationEventPublisherAware</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomEventPublisher</span> <span class="kd">implements</span> <span class="n">ApplicationEventPublisherAware</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">ApplicationEventPublisher</span> <span class="n">publisher</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApplicationEventPublisher</span><span class="o">(</span><span class="n">ApplicationEventPublisher</span> <span class="n">publisher</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">publish</span><span class="o">(){</span>
        <span class="n">ConstomEvent</span> <span class="n">ce</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomEvent</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">publisher</span><span class="o">.</span><span class="na">publishEvent</span><span class="o">(</span><span class="n">ce</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//To create a custom event handler, handler class needs to implement ApplicationListener&lt;CustomEvent&gt;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomEventHandler</span> <span class="kd">implements</span> <span class="nf">ApplicationListener</span><span class="o">(</span><span class="n">CustomEvent</span><span class="o">){</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onApplicationEvent</span><span class="o">(</span><span class="n">CustomEvent</span> <span class="n">event</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//...</span>
<span class="n">ConfiguraableApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

<span class="n">CustomEventPublisher</span> <span class="n">cvp</span> <span class="o">=</span> <span class="o">(</span><span class="n">CustomEventPublisher</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"customEventPublisher"</span><span class="o">);</span>
<span class="n">cvp</span><span class="o">.</span><span class="na">publish</span><span class="o">();</span> <span class="c1">//My Custom Event</span>
<span class="n">cvp</span><span class="o">.</span><span class="na">publish</span><span class="o">();</span> <span class="c1">//My Custom Event</span>
</pre>


<h2>Chapter 19: AOP with Spring Framework</h2>
<p><code>Aspect Oriented Programming (AOP)</code> entails <em>breaking down</em> program logic into distinct parts called <code>concerns</code>,or <code>crossing-cutting concerns</code>. These concerns are conceptually separate from the application's bussiness logic.</p>
<p>Spring AOP modules provides interceptors to intercept an application. For example. when a method is executed, you can <em>add extra functionality</em> before or after the method execution.</p>
<p _="%" images_posts_aop_term2.png="images/posts/AOP_Term2.png" img><em>AOP Terminologies</em>
{% img images/posts/AOP_Term1.png %}</p>
<p _="%" images_posts_aop_advice.png="images/posts/AOP_Advice.png" img><em>Type of Advice</em></p>
<h3>XML Schema Based Aspect Implementation</h3>
<p>Use regular classes along with <code>xml</code> based configuration</p>
<p><code>xml</code> needs to be configured:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span>
       <span class="na">xmlns:aop=</span><span class="s">"..."</span>
       <span class="na">xmlns:schemaLocation=</span><span class="s">"..."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>You need to add <code>AspectJ</code> libraries to your CLASSPATH.</p>
<p>The way to <em>declare</em> an <code>aspect</code> is using <code>&lt;aop:aspect&gt;</code> element and usint <code>ref</code> attribute to find bean:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"testAspect"</span> <span class="na">ref=</span><span class="s">"testBean"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;/aop:aspect&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"testBean"</span> <span class="na">class=</span><span class="s">"..."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>The way to <em>declare</em> an <code>pointcut</code> is to use <code>&lt;aop:pointcut&gt;</code> elements. <code>pointcut</code> is sued to determine the <code>method</code>(i.e. <code>join point</code>) to be excuted in advices:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"testAspect"</span> <span class="na">ref=</span><span class="s">"testBean"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"testAttribute"</span> <span class="na">expression=</span><span class="s">"execution(* com.xyz.Classes.*.*(...))"</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!--We use regular expression to make sure all classes under com.xyz.Classes package have a "testAttribute" attribute. This attribute can carry advices--&gt;</span>

        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"testArribute2"</span> <span class="na">express=</span><span class="s">"executon(* com.sample.Test.getName(...))"</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!--This means the method getName() in com.sample.Test class has a pointcut called testAttribute2--&gt;</span>
    <span class="nt">&lt;/aop:aspect&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"testBean"</span> <span class="na">class=</span><span class="s">"..."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>The way to <em>declare</em> an <code>advice</code> is to add <em>five</em> advices inside an <code>&lt;aop:aspect&gt;</code> element, using <code>&lt;aop:{ADVICE Name}&gt;</code> element:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"testAspect"</span> <span class="na">ref=</span><span class="s">"testBean"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"testAttribute"</span> <span class="na">expression=</span><span class="s">"execution(* com.sample.test.*.*(...))"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;aop:before</span> <span class="na">pointcut-ref=</span><span class="s">"testAttribute"</span> <span class="na">method=</span><span class="s">"task"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;aop:after</span> <span class="na">pointcut-ref=</span><span class="s">"testAttribute"</span> <span class="na">method=</span><span class="s">"task"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;aop:around</span> <span class="na">pointcut-ref=</span><span class="s">"testAttribute"</span> <span class="na">method=</span><span class="s">"task"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;aop:after-returning</span> <span class="na">returning=</span><span class="s">"retVal"</span> <span class="na">pointcut-ref=</span><span class="s">"testAttribute"</span> <span class="na">method=</span><span class="s">"task"</span><span class="nt">/&gt;</span><span class="c">&lt;!--method must hava papameter named retVal--&gt;</span>
        <span class="nt">&lt;aop:after-throwing</span> <span class="na">throwing=</span><span class="s">"ex"</span> <span class="na">pointcut-ref=</span><span class="s">"testAttribute"</span> <span class="na">method=</span><span class="s">"task"</span><span class="nt">/&gt;</span><span class="c">&lt;!--method must hava papameter named ex--&gt;</span>
    <span class="nt">&lt;/aop:aspect&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"testBean"</span> <span class="na">class=</span><span class="s">"..."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span>
       <span class="na">xmlns:aop=</span><span class="s">"..."</span>
       <span class="na">xmlns:schemaLocation=</span><span class="s">"..."</span>
<span class="nt">&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"log"</span> <span class="na">ref=</span><span class="s">"logging"</span><span class="nt">&gt;</span> <span class="c">&lt;!--Spring will find a bean with id logging for aspect class--&gt;</span>
            <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"selectAll"</span> <span class="na">expression=</span><span class="s">"execution(* com.sample.setName(...))"</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!--Here we define advices trriger for method setName() --&gt;</span>
            <span class="nt">&lt;aop:before</span> <span class="na">pointcut-ref=</span><span class="s">"selectAll"</span> <span class="na">method=</span><span class="s">"beforeAdvice"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;aop:after</span> <span class="na">pointcut-ref=</span><span class="s">"selectAll"</span> <span class="na">method=</span><span class="s">"afterAdvice"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;aop:after-returning</span> <span class="na">pointcut-ref=</span><span class="s">"selectAll"</span> <span class="na">returning=</span><span class="s">"retVal"</span> <span class="na">method=</span><span class="s">"afterReturingAdvice"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;aop:after-throwing</span> <span class="na">pointcut-ref=</span><span class="s">"selectAll"</span> <span class="na">throwing=</span><span class="s">"ex"</span> <span class="na">method=</span><span class="s">"AfterThrowingAdvice"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/aop:aspect&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"student"</span> <span class="na">class=</span><span class="s">"com.sample.Student"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Tim"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"age"</span> <span class="na">value=</span><span class="s">"11"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"logging"</span> <span class="na">class=</span><span class="s">"com.sample.Logging"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Logging</span><span class="o">{</span>
    <span class="c1">//Execute before a selected method execution</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeAdvice</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Before Execution"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//Execute after a selected method execution</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterAdvice</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After Execution"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//Execute when any method returns</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturningAdvice</span><span class="o">(</span><span class="n">Object</span> <span class="n">retVal</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returning Execution"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//Execute if there is any exception raised</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">AfterThrowingAdvice</span><span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">ex</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Exception Execution"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">//Assume we have getter and setter for them with message print out</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printThrowException</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Exception raise"</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>
        <span class="n">Student</span> <span class="n">student</span> <span class="o">=</span> <span class="o">(</span><span class="n">Student</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"student"</span><span class="o">);</span>

        <span class="n">student</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">student</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Ann"</span><span class="o">);</span>
        <span class="n">student</span><span class="o">.</span><span class="na">printThrowException</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Output:</span>
<span class="c1">//Tim</span>
<span class="c1">//Before Execution</span>
<span class="c1">//Returning Execution</span>
<span class="c1">//After Execution</span>
<span class="c1">//Exception Execution</span>
</pre>


<h3>@AspectJ Based AOP with Spring</h3>
<p><code>@AspectJ</code> refers a style of declaring aspects as regular <em>Java classes</em> with Java 5 annotations.</p>
<p>You need to add <code>&lt;aop:aspectj-autoproxy&gt;</code> in <code>xml</code> file first.</p>
<p>You also need AspectJ libraries in your CLASSPATH</p>
<p>To <em>declaring</em> an <code>aspect</code>, you add <code>@Aspect</code> above the class name.</p>
<p>To <em>declaring</em> an <code>pointcut</code>, you need to declar two parts:</p>
<p>A <em>pointcut expression</em> using <code>@Pointcut</code></p>
<p>A <em>pointcut signature</em>, which is a method without implementation. The name of the method is like the id of pointcut in <code>xml</code> file above:</p>
<pre class="code literal-block"><span></span><span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"execution(*com.sample.*.*(...))"</span><span class="o">)</span> <span class="c1">//Pointcut expression, telling Spring the place to exectue advices</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">testAttribute</span><span class="o">();</span> <span class="c1">//Pointcut Signature</span>
</pre>


<p>To <em>declaring</em> <code>advice</code>, using <code>@{advice_name}</code> annotations:</p>
<pre class="code literal-block"><span></span><span class="nd">@Before</span><span class="o">(</span><span class="s">"testAttribute()"</span><span class="o">)</span> <span class="c1">//pointcut expression. We use method here</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doBeforeTask</span><span class="o">(){...}</span>

<span class="nd">@Before</span><span class="o">(</span><span class="s">"testAttribute()"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAfterTask</span><span class="o">(){...}</span>

<span class="nd">@Around</span><span class="o">(</span><span class="s">"testAttribute()"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAroundTask</span><span class="o">(){...}</span>

<span class="nd">@AfterReturning</span><span class="o">(</span><span class="n">pointcut</span><span class="o">=</span><span class="s">"testAttribute()"</span><span class="o">,</span><span class="n">returning</span><span class="o">=</span><span class="s">"retVal"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAfterReturnningTask</span><span class="o">(</span><span class="n">Object</span> <span class="n">retVal</span><span class="o">){...}</span>

<span class="nd">@AfterThrowing</span><span class="o">(</span><span class="n">pointcut</span><span class="o">=</span><span class="s">"testAttribute()"</span><span class="o">,</span><span class="n">throwing</span><span class="o">=</span><span class="s">"ex"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAfterThrowingTask</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">){...}</span>
</pre>


<p>Example:</p>
<p>XML:
    :::xml
    <!--Assume we have xmln:aop...-->
    <aspectj-autoproxy></aspectj-autoproxy></p>
<pre class="code literal-block"><span></span>&lt;!--Assume we have Student bean the same as example above--&gt;
&lt;!--Assume we have Logging bean the same as example above--&gt;
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Logging</span><span class="o">{</span>
    <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"exectution(*com.sample.Student.setName(...))"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">selectAll</span><span class="o">();</span>   <span class="c1">//If we use xml, this is defined in xml file. Now we move it to jave</span>

    <span class="nd">@Before</span><span class="o">(</span><span class="n">selectAll</span><span class="o">())</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeAdvice</span><span class="o">(){</span>
        <span class="c1">//same as last example</span>
    <span class="o">}</span>
    <span class="nd">@After</span><span class="o">(</span><span class="n">selectAll</span><span class="o">())</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterAdvice</span><span class="o">(){</span>
        <span class="c1">//same as last example</span>
    <span class="o">}</span>
    <span class="nd">@AfterReturning</span><span class="o">(</span><span class="n">pointcut</span><span class="o">=</span><span class="s">"selectAll()"</span><span class="o">,</span> <span class="n">returning</span><span class="o">=</span><span class="s">"retVal"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturningAdvice</span><span class="o">(</span><span class="n">Object</span> <span class="n">retVal</span><span class="o">){</span>
        <span class="c1">//same as last example</span>
    <span class="o">}</span>
    <span class="nd">@AfterThrowing</span><span class="o">(</span><span class="n">pointcut</span><span class="o">=</span><span class="s">"selectAll()"</span> <span class="n">throwing</span><span class="o">=</span><span class="s">"ex"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">AfterThrowingAdvice</span><span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">ex</span><span class="o">){</span>
        <span class="c1">//same as last example</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//If we run Test.java from last example, we should get same results.</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-14-to-16.html">Reading Notes for Spring 3 Core Components Tutorial Part Part III (Chapter 14 to Chapter 16)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-14-to-16.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-14-to-16.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 14 to Chapter 16 in tutorial.</p>
<h2>Chapter 14: Spring Beans Auto-Wiring</h2>
<p><em>This is an example of my own problem:</em> I tried to use <code>jdbctemplate.update()</code> function to insert data, which is passed from controller by a <em>DAO</em> object.</p>
<p>No matter how hard I try, even using hard-code for sql statement, I kept getting <code>nested exception: java.lang NullPointerException</code> error. Problem did not get solved until I realize instead of just declare a DAO object and call update method, I should declare a DAO as a <em>class variable</em>, and add <code>@autowired</code> to it, such as:</p>
<pre class="code literal-block"><span></span><span class="c1">//In xml, we have &lt;bean id="userDAO" class="..."&gt;&lt;/bean&gt;</span>

<span class="kn">import</span> <span class="nn">com.sample.userDAO</span><span class="o">;</span>

<span class="nd">@Autowired</span>
<span class="n">userDAO</span> <span class="n">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateInController</span><span class="o">(){</span>
    <span class="c1">//Object some_object = new Object();</span>
    <span class="c1">// some_object.setName()...etc</span>

    <span class="c1">//updateOperation() is the method in another class using jdbc.update()</span>
    <span class="c1">//If I just create a userDAO instance then do following, I will get NullPointerException</span>
    <span class="n">dao</span><span class="o">.</span><span class="na">updateOperation</span><span class="o">(</span><span class="n">some_object</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<p>Spring can <em>auto-wire</em> relationships between beans without using <code>&lt;constructor-arg&gt;</code> or <code>&lt;property&gt;</code></p>
<h3>Auto-wiring Modes</h3>
<p _="%" images_posts_auto-wiring.png="images/posts/auto-wiring.png" img>You should be <code>autowire</code> attribute of the <code>&lt;bean/&gt;</code> element to specify autowire mode for a bean definition. There are four Auto-wiring modes, which are defined in this following table:</p>
<p><code>byType</code> or <code>constructor</code> autowiring mode can be used to wire <em>arrays</em> and other <em>typed-collections</em>.</p>
<h3>Limitations with Autowiring</h3>
<p _="%" images_posts_autowiring-limitation.png="images/posts/autowiring-limitation.png" img>Autowiring is great to use across a project. However, it do have limitations and you can override it:</p>
<h3>Autowiring By Name*</h3>
<p>Spring container looks at the beans on which has a <code>autowirte</code> attribute in <code>xml</code> configuration file.</p>
<p>Then it will go to the java bean class for this bean, and find all attributes that have <code>setter</code> for this bean.</p>
<p>Then it will come back to <code>xml</code> file, check other bean name, until it find <em>one</em> bean that has same <em>class type (i.e. class="...")</em> as this bean's attribute variable <em>name</em>.</p>
<p>Spring will initialize this bean, based on configuration file. Then Spring will finish previous bean's initialization process.</p>
<p>If Spring finds more than one bean in <code>xml</code> file, it will report a error.</p>
<p>Example:</p>
<p>XML:
    :::xml
    <bean id="textEditor" class="com.example.TextEditor" autowire="byName"><property name="name" value="Generic Text Editor"></property></bean></p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--this bean will be detected since it has same name as the attribute which has a setter--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.example.SpellChecker"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>Java:
    :::java
    //java bean class for textEditor
    public class TextEditor{
        private spellChecker spellChecker; //Spring will find this since it has the same name as spellChecker
        private String name;</p>
<pre class="code literal-block"><span></span>    public void setSpellChecker(SpellChecker spellChecker){
        this.spellChecker = spellChecker;
    }
    public SpellChecker getSpellChecker(){
        return spellChecker;
    }

    public void setName(String name){
        this.name = name;
    }
    public String getName(){
        return name;
    }

    public void spellCheck(){
        spellChecker.checkSpelling();
    }
}

//java bean class for spellChecker
public class SpellChecker{
    public spellChecker(){
        System.out.println("Inside spellChecker constructor");
    }
    public void checkSpelling(){
        System.out.println("checkSpelling in spellChecker class");
    }
}
//Test class
public class Test{
    public static void main(String[] args){
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");

        //In this step, java will do autowire, which include instantiate spellChecker
        TextEditor te = (TextEditor) context.getBean("textEditor");
        te.spellCheck();

        //Output:
        //Inside sellChecker constructor
        //checkSpelling in spellChecker class
    }
}
</pre>


<h3>Autowiring By Type</h3>
<p>Spring first check <code>xml</code> configuration file, find a bean with <code>autowire</code> attribute that marked as <code>byType</code>.</p>
<p>Spring will go to this bean's java class, then find all its atrribute variables that have <code>setter</code>.</p>
<p>Spring comes back to <code>xml</code> then go through all the beans. As long as it finds <em>one</em> bean that has same <em>name</em> as java class attribute's <em>type</em>. Spring will instantiate this specific bean.</p>
<p>If Spring finds more than one bean in <code>xml</code> file, it will report a error.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span> <span class="na">autowire=</span><span class="s">"byType"</span><span class="nt">&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Generic Text Editor"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"xxx"</span> <span class="na">class=</span><span class="s">"com.sample.SpellChecker"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Here is different from auto-wiring by name. Although we use a different id, Spring still find its type is SpellChecker, which is the type that the original attribute has, so Spring can recoginize it as same type--&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>Java:</p>
<pre class="code literal-block"><span></span><span class="c1">//TextEditor.java and SpellChecker.java are the same as above</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="kd">static</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"bean.xml"</span><span class="o">);</span>
        <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">te</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"textEditor"</span><span class="o">);</span>

        <span class="n">te</span><span class="o">.</span><span class="na">spellCheck</span><span class="o">();</span>

        <span class="c1">//Output:</span>
        <span class="c1">//Inside sellChecker constructor</span>
        <span class="c1">//checkSpelling in spellChecker class</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Autowiring By Constructor</h3>
<p>Autowirng by <em>constructor</em> is very similar to autowiring by <em>type</em>. The only difference is it works on <em>constructor</em>.</p>
<p>So now Spring will check <code>xml</code> file with <code>autowire="constructor"</code> attribute, then go to this java bean class and find this bean's constructor parameters.</p>
<p>Spring comes back to <code>xml</code> and go through all beans. As long as it find <em>one</em> bean that has same <em>name</em> as the <em>type</em> of constructor parameter, Spring will instantiated this bean based on its configuration, then instantiates original bean.</p>
<p>If Spring find more than one bean which hava same name as original bean's constructor parameter type, it will report an error.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span> <span class="na">autowire=</span><span class="s">"constructor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">"Generic Text Editor"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--note this value has String type. So when Spring go to construcor, it will try to find a string parameter and put value on it--&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ttt"</span> <span class="na">class=</span><span class="s">"com.sample.SpellChecker"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Here ttt bean has class as SpellChecker and the original bean's contructor use parameter which also has type as SpellChecker, so Spring can recoginize it as same type--&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

<span class="c1">//Spring will find a bean that has id as SpellChecker</span>
<span class="kd">public</span> <span class="nf">TextEditor</span><span class="o">(</span><span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">SpellChecker</span> <span class="nf">getSpellChecker</span><span class="o">(){</span>
    <span class="k">return</span> <span class="n">spellChecker</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">(){</span>
    <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
    <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">//Assuame SpellChecker.java is the same as example above</span>
<span class="kd">public</span> <span class="n">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">();</span>
        <span class="n">TextEditor</span> <span class="n">te</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">te</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>
        <span class="n">te</span><span class="o">.</span><span class="na">spellCheck</span><span class="o">();</span>

        <span class="c1">//Output:</span>
        <span class="c1">//Inside sellChecker constructor</span>
        <span class="c1">//checkSpelling in spellChecker class</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h2>Chapter 15: Spring Annotation Based Configuration</h2>
<p>Instead of using <code>xml</code> to do <em>auto-wiring</em>, you can use move the auto-wiring part to bean's <code>java class</code>.</p>
<p>Since annotation is performed <em>before</em> xml configuration, auto-writing in xml can <em>override</em> annotation.</p>
<p>To add anonotation, make sure you put <code>&lt;context:annotation-config/&gt;</code> in <code>&lt;beans&gt;&lt;/beans&gt;</code> in xml file, then add your bean configuration after this line.</p>
<p>There are four types of annotation:</p>
<ul>
<li>
<p><code>@Required</code>: apply to <code>setter</code> methods</p>
</li>
<li>
<p><code>@Autowired</code>: apply to <code>settter</code> methods or <code>non-setter</code> methods or <code>constructors</code> or <code>properties</code>.</p>
</li>
<li>
<p><code>@Qualifier</code>: apply with <code>@Autowirted</code></p>
</li>
<li>
<p><code>@JSO-250 Annotations</code>: includes <code>@Resource</code>, <code>@PostConstruct</code> adn <code>@PreDestroy</code></p>
</li>
</ul>
<h3>@Required Annotation</h3>
<p><code>@Required</code> applys to <code>setter</code>. It means a configuration in <code>xml</code> for this attribute <em>type</em> must be declared. Otherwise it will report <code>BeanInitializationException</code> error.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Must sure you include this for annotation--&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"student"</span> <span class="na">class=</span><span class="s">"com.test.Student"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Tim"</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!--Comment this out. @Required will raise error message because of this--&gt;</span>
        <span class="c">&lt;!--&lt;property name="age" value="11"/&gt;</span>
<span class="c">    &lt;/bean&gt;</span>
<span class="c">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Required</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="n">Integer</span> <span class="n">aga</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getAge</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Required</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Now if we initialize bean "student", we will get a error message, said Property 'age' is required for bean "student"</span>
</pre>


<h3>@Autowired Annotation</h3>
<h4>@Autowired on Setter Methods</h4>
<p>Instead of put <code>&lt;property&gt;</code> in <code>xml</code> file, you can use <code>@Autowired</code> on setter to do a <em>byType autowiring</em>.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.sample.SpellChecker"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="n">TextEditor</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSpellChecker</span><span class="o">(</span><span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">SpellChecker</span> <span class="nf">getSpellChecker</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
        <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Assume SpellChecker.java is the same as exmaple above</span>
<span class="c1">//Assume main class is the same as example above</span>

<span class="c1">//Output:</span>
<span class="c1">//Inside sellChecker constructor</span>
<span class="c1">//checkSpelling in spellChecker class</span>
</pre>


<h4>@Autowired on Properties</h4>
<p>Instead of creating a <code>setter</code>, you can put <code>@Autowired</code> annotation on the property/attribute declaration.</p>
<p>In <code>xml</code>, after you configure using <code>&lt;property&gt;</code>, Spring will automatically create a <code>setter</code> for this attribute, using the configuration in <code>xml</code> file for setter's bean. If you define a value in <code>&lt;property&gt;</code>, the value will be passed.</p>
<p>When Spring search for corresponding setter bean in <code>xml</code> file, it will refer <code>id</code> in each beans.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"spellChecker"</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- You should do &lt;property name='test' value="ttt"/&gt; if SpellChecker has a String attribute called test and you want its value to be "ttt"--&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.sample.SpellChecker"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="n">TextEditor</span><span class="o">{</span>
    <span class="nd">@Autowried</span>
    <span class="kd">private</span> <span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="c1">//Now Spring will set for a bean with id "spellChecker", and create setter based on that bean</span>

    <span class="kd">public</span> <span class="nf">TextEditor</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">prinlnt</span><span class="o">(</span><span class="s">"construtor for TextEditor"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">SpellChecker</span> <span class="nf">getSpellChecker</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
        <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Now, if we run Text.java in example above, we will get:</span>
<span class="c1">//construtor for TextEditor.    Since we have constructor now, when we instanitated a TextEditor bean, constructor will be called first.</span>
<span class="c1">//Inside sellChecker constructor    This is in SpellChecker.java, since we call spellCheck() function</span>
<span class="c1">//checkSpelling in spellChecker class</span>
</pre>


<h4>@Autowired on Constructors*</h4>
<p><code>@Autowired</code> on constructor means even if no <code>&lt;constructor-arg&gt;</code> exists, Spring should check if there is any bean that has same <code>id</code> as constructor's <em>parameter name</em>.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume bean.xml is the same as above</span>
<span class="kd">public</span> <span class="n">TextEditor</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">;</span>

        <span class="nd">@Autowired</span>
        <span class="kd">public</span> <span class="nf">TextEditor</span><span class="o">(</span><span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"TextEditor Constructor"</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="o">}</span>

<span class="c1">//If we do same thing in test.java we will get:</span>
<span class="c1">//TextEditor Constructor     This is because we call this first in construtor</span>
<span class="c1">//Inside sellChecker constructor</span>
<span class="c1">//checkSpelling in spellChecker class</span>
</pre>


<h4>@Autowired with (required=false) Option</h4>
<p>When you add <code>@Autowired</code> to setter, you can add use <code>@Autowired(required=false)</code> to make sure if this setter doesn't has a bean in <code>xml</code> file, it is still fine.</p>
<h4>@Qualifier Annotation</h4>
<p>You can use <code>@Qualifier</code> with <code>@Autowire</code> to select <em>only one</em> bean if you have many beans with <em>same type</em>. This should be added on properties.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;context:annotation-config/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"all"</span> <span class="na">class=</span><span class="s">"com.sample.All"</span><span class="nt">&gt;&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"item1"</span> <span class="na">class=</span><span class="s">"com.sample.Item"</span><span class="nt">&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Tim"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"item2"</span> <span class="na">class=</span><span class="s">"com.sample.Item"</span><span class="nt">&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Jane"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">All</span><span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"item1"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Item</span> <span class="n">item</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">All</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printName</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">prinlnt</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="c1">//If you test it, this should output "Tim" because we only autowire with "item1"</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Spring JSP-250 Annotations</h3>
<h4>@PostContruct and @PreDestroy Annotations</h4>
<p><code>@PostConstruct</code> is to be added on the method that <code>init=XXX</code> in <code>xml</code> file.</p>
<p><code>@PreDestroy</code> is to be added on the method that <code>destroy=XXX</code> in <code>xml</code> file.</p>
<h4>@Resource</h4>
<p>Follows <em>byName</em> convention, it takes a <em>self-defined</em> name or default <em>property</em> or <em>setter</em> name in java file, then come to <code>xml</code> file to find the bean with same name.</p>
<p>It can be added on <code>properties</code> or <code>setters</code>.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="c1">//Now it will try to find bean with name "XXX". If name is not defined, it will find bean with name "spellChecker"</span>
<span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"XXX"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSpellChecker</span><span class="o">(</span><span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">){</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</pre>


<h2>Chapter 16: Spring Java Based Configuration</h2>
<p>Java based configuration enables you to write most of your Spring configuration without xml.</p>
<h3>@Configuration and @Bean</h3>
<p><code>@Configuration</code> applys to a <code>class</code>, which means this java class is used to configure Spring beans (i.e. It is a <code>IoC Container</code>).</p>
<p><code>@Bean</code> applys to <code>properties</code>/<code>methods</code> inside configuration class. It automatically pick up bean ID and returns actual bean.</p>
<p>A <code>@Configuration</code> class can have more than one <code>@Bean</code>.</p>
<p>Use <code>AnnotationConfigApplicationContext</code> to get context.</p>
<p>You can do <code>context.register();</code> to load more than one configuration class to one context:</p>
<pre class="code literal-block"><span></span><span class="c1">//If you only load one java configuration class here, you can use ApplicationContext ctx = new AnnotationConfigApplicationContext();</span>
<span class="n">AnnotationConfigApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">();</span>

<span class="n">ctx</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">OtherAppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span>

<span class="n">Item1</span> <span class="n">item</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ItemOne</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">//ItemOne should be marked with @Bean</span>
</pre>


<p>Example:</p>
<pre class="code literal-block"><span></span><span class="c1">//This is not HelloWorld.java. This is the special Spring configuration class</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">HelloWorld</span> <span class="nf">helloWorld</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">HelloWorld</span><span class="o">();</span>
        <span class="c1">//Since this is a bean, Spring will find HelloWorld.java for instantiation</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="c1">//Assume we have getter and setter for message</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
            <span class="n">ApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">HelloWorldConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">//Find Config Class</span>

            <span class="n">HelloWorld</span> <span class="n">hw</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloWorld</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">HelloWorld</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">//Find Bean</span>
            <span class="c1">//Now HelloWorld getter and setter will work if we call them</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Injecting Bean Dependencies</h3>
<p>To mark one bean has <em>dependency</em> with another bean, just <em>call</em> this bean from anther bean.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextEditorConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">TextEditor</span> <span class="nf">textEditor</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">TextEditor</span><span class="o">(</span><span class="n">spellChecker</span><span class="o">());</span>
        <span class="c1">//This means TextEditor has constrctor-arg or property that needs to call spellChecker</span>
    <span class="o">}</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">SpellChecker</span> <span class="nf">spellChecker</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">SpellChecker</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">publc</span> <span class="kd">class</span> <span class="nc">TextEditor</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">;</span> <span class="c1">//You still need to define another bean(spellChecker) in this bean class</span>

    <span class="kd">public</span> <span class="nf">TextEditor</span><span class="o">(</span><span class="n">SpellChecker</span> <span class="n">spellChecker</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">our</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"TextEditor Constructor"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
        <span class="c1">//You needs to put spellChecker as constructor parameter here, because you define this way in config java class</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
        <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Assume we SpellCheck.java is the same as examples before with a constrctor</span>
<span class="c1">//Assume Test.java is the same as example before</span>
<span class="c1">//Output should be:</span>
<span class="c1">//SpellChecker Constructor  This comes first because since spellChecker is constructor parameter, it goes to instantiate this bean first</span>
<span class="c1">//TextEditor Constructor</span>
<span class="c1">//CheckSpelling</span>
</pre>


<h3>@Import Annotation</h3>
<p>You can use <code>@Import</code> for beans from another configuration class.</p>
<p>When you define class to ApplicationContext, only non-import bean needs to be defined.</p>
<p>Example:</p>
<pre class="code literal-block"><span></span><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">A</span> <span class="nf">a</span><span class="o">(){</span>
        <span class="c1">//Assume there exists a A class</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">AConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">B</span> <span class="nf">a</span><span class="o">(){</span>
    <span class="c1">//Assume there exists a B class</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//main class</span>
<span class="n">ApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">BConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">//Both AConfig and BConfig are available</span>
<span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">A</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">B</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre>


<h3>Init and Destroy</h3>
<p>You can use <code>initMethod</code> and <code>destoryMethod</code> with <code>@Bean</code> for initialization and destroy of the bean:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(){</span>
    <span class="c1">//...</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">(){</span>
    <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">initMethod</span><span class="o">=</span><span class="s">"init"</span><span class="o">,</span> <span class="n">destroyMethod</span><span class="o">=</span><span class="s">"cleanup"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Foo</span> <span class="n">foo</span><span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Bean Scope</h3>
<p>Default scope is <code>singleton</code>. You can use <code>@Scope</code> to define other scopes:</p>
<pre class="code literal-block"><span></span><span class="nd">@Bean</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="s">"prototype"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Foo</span> <span class="nf">foo</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="o">}</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-11-to-13.html">Reading Notes for Spring 3 Core Components Tutorial Part II (Chapter 11 to Chapter 13)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-11-to-13.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-11-to-13.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<p>This note includes Chapter 11 to Chapter 13 in tutorial.</p>
<h2>Chapter 11: Spring Dependency Injection</h2>
<p>Dependency Injection (or Wiring) helps in gluing individual application classes together and same time keeping them independent.</p>
<p>There are two types of DI: <code>Constructor-Based</code> DI and <code>Setter-Based</code> DI:</p>
<ul>
<li>
<p>Constructor-based DI is accomplished when the container invokes a <em>class constructor</em> with a number of arguments, each representing a dependency on other class.</p>
</li>
<li>
<p>Setter-based DI is accomplished by the container calling <em>setter</em> methods on your beans <em>after</em> invoking a <em>no-argument constructor</em> or <em>no-argument static factory</em> method to instantiate your bean.</p>
</li>
</ul>
<p>It is a good practive to <em>use constructor arguments for</em> <strong>mandatory dependencies</strong> <em>and setter for</em> <strong>option dependencies</strong></p>
<h3>Constructor-Based Dependency Injection</h3>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;contructor-arg</span> <span class="na">ref=</span><span class="s">"spellChecker"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.sample.spellChecker"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Constructor for textEditor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextEditor</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">SpellCheck</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="c1">//Constructor that takes one argument</span>
    <span class="kd">public</span> <span class="nf">TextEditor</span><span class="o">(</span><span class="n">SpellCheck</span> <span class="n">spellChecker</span><span class="o">){</span>
        <span class="c1">//A SpellCheck will be instantiated first, based on bean setting</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Construcor of Text Editor"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
        <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Constructor for spellChecker</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">spellChecker</span><span class="o">{</span>
        <span class="c1">//Construcor that doesn't take any argument</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">prinln</span><span class="o">(</span><span class="s">"Construcor of Spell Checker"</span><span class="o">)</span><span class="err">'</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkSpelling</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Checking Spelling !"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="c1">//Main Class</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>
    <span class="n">pulic</span> <span class="kt">void</span> <span class="kd">static</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
    <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="err">'</span><span class="n">bean</span><span class="o">.</span><span class="na">xml</span><span class="err">'</span><span class="o">);</span>

    <span class="n">TextEditor</span> <span class="n">te</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="err">'</span><span class="n">textEditor</span><span class="err">'</span><span class="o">);</span>
    <span class="n">te</span><span class="o">.</span><span class="na">spellCheck</span><span class="o">();</span>

    <span class="c1">//Output: Contrutor of Spell Checker</span>
    <span class="c1">//Output: Contrutor of Text Editor</span>
    <span class="c1">//Output: Check Spelling !</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Consructor Arguments Resolution</h3>
<p><code>Ambiguity</code> can happen when a constroctor takes more than one parameters. Spring make sure the <em>order</em> of <code>constrctor-arg</code> in bean <code>xml</code> file defines the <em>order</em> of parameters taken by construcor in <code>java</code> file.</p>
<p>If you have <code>type</code> attribute in <code>xml</code> file, Spring can use <em>Type-Matching</em> to check these parameters.</p>
<p><strong>Important</strong>: If you try to pass <em>reference</em> in <code>&lt;constructor-args&gt;</code>, use <code>ref</code> attribute. If you try to pass <em>value</em> in <code>&lt;constructor-args&gt;</code>, use <code>value</code> attribute.</p>
<p>The best way is to use <code>index</code> attribute in <code>xml</code> file. Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"foo"</span> <span class="na">class=</span><span class="s">"x.y.Foo"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"bar"</span><span class="nt">/&gt;</span> <span class="c">&lt;!--part by reference--&gt;</span>
        <span class="nt">&lt;constroctor-arg</span> <span class="na">index=</span><span class="s">"1"</span> <span class="na">type=</span><span class="s">"java.lang.String"</span> <span class="na">value=</span><span class="s">"Test"</span><span class="nt">/&gt;</span> <span class="c">&lt;!--pass by value. Specify type here--&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"bar"</span> <span class="na">class=</span><span class="s">"x.y.Bar"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Class for Foo</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Bar</span> <span class="n">bar</span><span class="o">,</span> <span class="n">Stirng</span> <span class="n">t</span><span class="o">){</span>
        <span class="c1">//Here bar call its own constructor</span>
        <span class="c1">//t have value "test", which is defined in xml file</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h3>Setter-based Dependncy Injection</h3>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"textEditor"</span> <span class="na">class=</span><span class="s">"com.sample.TextEditor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"spellChecker"</span> <span class="na">ref=</span><span class="s">"spellChecker"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.sample.SpellChecker"</span><span class="nt">&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Class for spellChecker</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span><span class="o">{</span>
    <span class="c1">//Constructor</span>
    <span class="kd">public</span> <span class="nf">SpellChecker</span><span class="o">(){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"spellChecker constructor!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkSpelling</span><span class="o">(){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"checkSpelling!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Class for textEditor</span>
<span class="c1">//This class use default-construcor (i.e, no self-defined constructor)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextEditor</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">SpellChekcer</span> <span class="n">spellChecker</span><span class="o">;</span>

    <span class="c1">//getter to ruturn a spellChecker</span>
    <span class="kd">public</span> <span class="n">SpellChecker</span> <span class="n">getSpellChecker</span><span class="o">{</span>
        <span class="k">return</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//setter</span>
    <span class="kd">public</span> <span class="n">ovid</span> <span class="nf">setSpellChecker</span><span class="o">(</span><span class="n">SepellChekcer</span> <span class="n">spellChecker</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"setSpellChecker!"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">spellChecker</span> <span class="o">=</span> <span class="n">spellChecker</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">spellCheck</span><span class="o">(){</span>
        <span class="n">spellChecker</span><span class="o">.</span><span class="na">checkSpelling</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Main Class</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="err">'</span><span class="n">beans</span><span class="o">.</span><span class="na">xml</span><span class="err">'</span><span class="o">);</span>
        <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">te</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextEditor</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBeans</span><span class="o">(</span><span class="err">'</span><span class="n">textEditor</span><span class="err">'</span><span class="o">);</span>
        <span class="n">te</span><span class="o">.</span><span class="na">spellCheck</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//Output: spellChecker constructor!</span>
    <span class="c1">//setSpellChecker!</span>
    <span class="c1">//checkSpelling!</span>
<span class="o">}</span>
</pre>


<p>The difference in <code>xml</code> file between Constructor DI and Setter-Base DI is: <code>&lt;construcotr-args&gt;</code> is used by Constructor DI; <code>&lt;property&gt;</code> is used by Setter-Based DI.</p>
<p>Similar as Constructor DI, if you want to pass <em>reference</em> in <code>xml</code> file, use <code>ref</code> attribute. If you want to pass <em>value</em> in <code>xml</code> file, use <code>value</code> attribute.</p>
<p><em>XML Configuration using P-Namespace</em></p>
<p><code>p-namespace</code> is easier for a bean with <em>many</em> setter methods.</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--old way--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"com.sample.test"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"John Smith"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"spouse"</span> <span class="na">ref=</span><span class="s">"jane"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jane"</span> <span class="na">class=</span><span class="s">"com.sample.Person"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"John Smith"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!--new way--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"com.sample.test"</span>
    <span class="na">p:name=</span><span class="s">"John Smith"</span>
    <span class="na">p:spouse-ref =</span> <span class="s">"jane"</span>
<span class="nt">&gt;</span> <span class="c">&lt;!--you don't need -value attribute if you pass by value--&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jane"</span> <span class="na">class=</span><span class="s">"com.sample.Person"</span>
    <span class="na">p:name=</span><span class="s">"John Smith"</span>
<span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<h2>Chapter 12: Spring Injecting Inner Beans</h2>
<p>The code above can be transferred to <code>inner bean</code>. Just like <code>inner class</code> in Java, <code>inner bean</code> is the bean defined inside <code>&lt;construcor-args&gt;</code> or <code>&lt;property&gt;</code>.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"testEditor"</span> <span class="na">class=</span><span class="s">"com.sample.testEditor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"spellChecker"</span><span class="nt">&gt;</span> <span class="c">&lt;!--only bean has id--&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"spellChecker"</span> <span class="na">class=</span><span class="s">"com.sample.spellChecker"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume the getter and setter for testEditor are the same as above</span>
<span class="c1">//Assume construcor for spellChecker is the same as above</span>
<span class="c1">//Assue main class is the same as above</span>

<span class="c1">//Output: spellChecker constructor!</span>
<span class="c1">//setSpellChecker!</span>
<span class="c1">//checkSpelling!</span>
</pre>


<h2>Chapter 13: Spring Injecting Collection</h2>
<p _="%" images_posts_spring-di-collection.png="images/posts/spring-di-collection.png" img>Spring has data type so you can pass value groups in <code>xml</code> file. There are four types: List, Set, Map and Properties. Difference is following:</p>
<p><em>You can use</em> <code>&lt;list&gt;</code> or <code>&lt;set&gt;</code> to wire any implementation of <code>java.util.Collection</code> or <code>Array</code>.</p>
<p>Same as single value, value collection can be passed by <em>value</em> or <em>reference</em>.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;beans&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"javaCollection"</span> <span class="na">class=</span><span class="s">"com.sample.javaCollection"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--List Example--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"addressList"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;value&gt;</span>USA<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>USA<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>UK<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="c">&lt;!--Set Example--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"addressSet"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;set&gt;</span>
                <span class="nt">&lt;value&gt;</span>USA<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>USA<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>UK<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/set&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="c">&lt;!--Map Example--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"addressMap"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"1"</span><span class="nt">&gt;</span>USA<span class="nt">&lt;/entry&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"2"</span><span class="nt">&gt;</span>USA<span class="nt">&lt;/entry&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"3"</span><span class="nt">&gt;</span>UK<span class="nt">&lt;/entry&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="c">&lt;!--Property Example--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"addressProp"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;props&gt;</span><span class="c">&lt;!--Note property has different structure--&gt;</span>
                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"one"</span><span class="nt">&gt;</span>USA<span class="nt">&lt;/prop&gt;</span>
                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"two"</span><span class="nt">&gt;</span>USA<span class="nt">&lt;/prop&gt;</span>
                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"three"</span><span class="nt">&gt;</span>UK<span class="nt">&lt;/prop&gt;</span>
            <span class="nt">&lt;/props&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Class for javaCollection</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaCollection</span><span class="o">{</span>
    <span class="n">List</span> <span class="n">addressList</span><span class="o">;</span>
    <span class="n">Set</span> <span class="n">addressSet</span><span class="o">;</span>
    <span class="n">Map</span> <span class="n">addressMap</span><span class="o">;</span>
    <span class="n">Properties</span> <span class="n">addressProp</span><span class="o">;</span>

    <span class="c1">//Assume each one has getter and setter, with corresponding output</span>
<span class="o">}</span>

<span class="c1">//Class for Test</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="err">'</span><span class="n">beans</span><span class="o">.</span><span class="na">xml</span><span class="err">'</span><span class="o">);</span>

        <span class="n">JavaCollection</span> <span class="n">jc</span> <span class="o">=</span> <span class="o">(</span><span class="n">JavaXollection</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="err">'</span><span class="n">javaCollection</span><span class="err">'</span><span class="o">);</span>

        <span class="n">jc</span><span class="o">.</span><span class="na">getAddressList</span><span class="o">();</span> <span class="c1">//USA, USA, UK</span>
        <span class="n">jc</span><span class="o">.</span><span class="na">getAddressSet</span><span class="o">();</span> <span class="c1">//USA, UK</span>
        <span class="n">jc</span><span class="o">.</span><span class="na">getAddressMap</span><span class="o">();</span> <span class="c1">//1=USA 2=USA 3=UK</span>
        <span class="n">jc</span><span class="o">.</span><span class="na">getAddressProp</span><span class="o">();</span> <span class="c1">//one=USA two=USA three=UK</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>In <code>xml</code> file, you can mix <code>references</code> and <code>values</code> together:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--List Example--&gt;</span>
<span class="nt">&lt;list&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"addressList1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"addressList2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value&gt;</span>UK<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/list&gt;</span>
<span class="c">&lt;!--Set Example--&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"addressSet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;set&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"address1"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"address2"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;value&gt;</span>UK<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/set&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="c">&lt;!--Map Example--&gt;</span>
<span class="nt">&lt;map&gt;</span>
    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"one"</span> <span class="na">value=</span><span class="s">"USA"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"two"</span> <span class="na">value-ref=</span><span class="s">"address1"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/map&gt;</span>

<span class="c">&lt;!--Reference Bean--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"address1"</span> <span class="na">class=</span><span class="s">"..."</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"address2"</span> <span class="na">class=</span><span class="s">"..."</span><span class="nt">&gt;&lt;/bean&gt;</span>
</pre>


<p>To use <em>empty</em> or <em>null</em> value in beans, you can do following:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"test"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">/&gt;</span> <span class="c">&lt;!--empty string--&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"test2"</span><span class="nt">&gt;&lt;null/&gt;&lt;/property&gt;</span> <span class="c">&lt;!--null--&gt;</span>
</pre>
</div>
            </div>
        </div>
        <div class="post">
            <h1 class="title"><a href="posts/2014/reading-spring-3-1-to-10.html">Reading Notes for Spring 3 Core Components Tutorial Part I (Chapter 1 to Chapter 10)</a></h1>
            <div class="meta">
                <div class="authordate">
                    <time class="timeago" datetime="2014-12-10T00:00:00-05:00">2014-12-10 00:00</time>
</div>
                <div class="stats">
                                <a href="posts/2014/reading-spring-3-1-to-10.html#disqus_thread" data-disqus-identifier="cache/posts/2014/reading-spring-3-1-to-10.html">Comments</a>


                </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="categories/java.html" rel="tag">Java</a></li>
        </ul>
</div>

            </div>
            <div class="body">
                <div>
<p>This post is transferred from my <a href="http://blogpengyin.herokuapp.com/">old Hexo blog site</a>, created on 2014.</p>
<p>This is a reading note from Spring Framework 3.1 Tutorial pdf, created by <a href="http://www.tutorialspoint.com/spring"><strong>tutorialspoint</strong></a>. This pdf contains information for Spring 3 Core Basics, which is very useful for understanding defination and practive in Spring programming.</p>
<h2>Chapter 2: Spring Framework Architecture</h2>
<p _="%" images_posts_spring-structure.png="images/posts/spring-structure.png" img>Spring is a modular framework, which means you can pick the modules that only fits your need. Basic structure of Spring framework is following. There are three <em>main</em> componets: <code>Core Container</code>, <code>Data Access Integration</code> and <code>Web (MVC/Remoting)</code>. Other important componets include <code>AOP</code>, <code>Aspects</code>, <code>Instrumentation</code> and <code>Test</code>:</p>
<h3>Core Container</h3>
<p><code>Core Container</code> contains: <code>Core</code> module, <code>Beans</code> module, <code>Context</code> module and <code>Expression Language</code> module:</p>
<ul>
<li>
<p><code>Core</code>: fundamental of framework, including <code>loC</code> and <code>Dependency Injection</code> features.</p>
</li>
<li>
<p><code>Beans</code>: has <code>Bean Factory</code>, implementing <em>factory pattern</em>.</p>
</li>
<li>
<p><code>Context</code>: based on <code>Core</code> module and <code>Beans</code> module. It is a medium to <em>access</em> any objects defined and configured. The <code>ApplicationContext</code> interface is the focal point of the <code>Context</code> module.</p>
</li>
<li>
<p><code>Expression Language</code>: provides language for <em>querying</em> and <em>manipulating</em> an object graph at run time.</p>
</li>
</ul>
<h3>Data Access/Integration</h3>
<p><code>Data Access/Integration</code> contains: <code>JDBC</code> module, <code>ORM</code> module, <code>OXM</code>, <code>JMS</code> module and <code>Transaction</code> module:</p>
<ul>
<li>
<p><code>JDBC</code>: provides a <em>JDBC-abstraction</em> layer that can simplify JDBC coding</p>
</li>
<li>
<p><code>ORM</code>: provide <em>integration</em> for popular <em>object-mapping</em> APIs, including <code>JPA</code>, <code>JDO</code>, <code>Hibernate</code>, <code>iBatis</code>.</p>
</li>
<li>
<p><code>OXM</code>: provide integration for <em>Object/XML mapping</em>, such as <code>JAXB</code>, <code>Castor</code>, <code>XMLBeans</code>, <code>JiBX</code> and <code>XStream</code></p>
</li>
<li>
<p><code>JSM</code>: <em>Java Messaging Service</em>. It can producing and consuming messages.</p>
</li>
<li>
<p><code>Transaction</code>: contains programmatic and declarative <em>transaction management</em> for classes and POJOs.</p>
</li>
</ul>
<h3>Web</h3>
<p><code>Web</code> contains: <code>Web</code> module, <code>Web-Servlet</code> module, <code>Web-Struts</code> module and <code>Web-Portlet</code> module:</p>
<ul>
<li>
<p><code>Web</code>: provide important functions for web development, such as <code>multipart file uploader</code> and <code>loC container</code> using <code>servlet listeners</code> and a web-oriented <code>application context</code>.</p>
</li>
<li>
<p><code>Web-Servlet</code>: provide Spring <code>MVC</code> implementation</p>
</li>
<li>
<p><code>Web-Structs</code>: provide support for Structs</p>
</li>
<li>
<p><code>Web-Portlet</code>: provide <code>MVC</code> implemention to be used in a <em>portlet</em> environment.</p>
</li>
</ul>
<h3>Other Components</h3>
<ul>
<li>
<p><code>AOP</code> module provides <code>aspect-oriented</code> programming implementation, allowing you to define method-interceptor or <em>pointcut</em>s to cleanly <em>decouple</em> code that implements functionality that should be <em>seperated</em>.</p>
</li>
<li>
<p><code>Aspects</code> module provides support for <code>AspectJ</code>.</p>
</li>
<li>
<p><code>Instrumenetation</code> module provide <em>class instrumentation</em> support and <em>class loader</em> implementation for certain application servers.</p>
</li>
<li>
<p><code>Test</code>: provides testing support for <code>JUnit</code> or <code>TestNG</code></p>
</li>
</ul>
<h2>Chapter 5: Spring Ioc Containers</h2>
<p>The main function of Spring IoC Container is to <em>create</em> objects, <em>wire</em> objects together, <em>configure</em> objects and <em>manage</em> objects in their lifecyle.</p>
<p>Spring IoC containter uses <code>dependency injection/DI</code> to manage objects, which are called spring <code>beans</code>.</p>
<p>Container gets information from the <code>metadata</code> in <code>xml</code>, <code>Java annotation</code> or <code>Java code</code>.</p>
<p _="%" images_posts_spring-containers.png="images/posts/spring-containers.png" img>This is the process of Spring IoC container works:</p>
<p>Spring has two distinct type of containers: <code>BeanFactory</code> and <code>ApplicationContext</code>:</p>
<p><code>BeanFactory</code>: this is the <em>simplest</em> container from DI. Most commonly used implementation is <code>XmlBeanFactory</code> class. It reading the configuration metadata from <code>xml</code> file and use it.</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"helloWorld"</span> <span class="na">class=</span><span class="s">"com.example.helloWorld"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">value=</span><span class="s">"Hello World!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">helloWorld</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span> <span class="c1">//with getter and setter</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">XmlBeanFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBeanFacotry</span><span class="o">(</span><span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="err">'</span><span class="n">Beans</span><span class="o">.</span><span class="na">xml</span><span class="err">'</span><span class="o">));</span>
        <span class="c1">//Note we use ClassPathResource so spring will find relative address for Beans.xml</span>

        <span class="n">helloWorld</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">factory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>
        <span class="c1">//Using casting here. Notice the factory.getBean() method use corespoding bean id. Then find name of class variable in &lt;property&gt;</span>

        <span class="n">obj</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span> <span class="c1">//return message in getter, which is Hello World!</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p><code>ApplicationContext</code>: More advanced and widely used container compare to the one above. This includes some enterprise-function. Most common implementations are: <code>FileSystemXmlApplicationContext</code>, <code>ClassPathXmlApplicationContext</code> and <code>WebXmlApplicationContext</code>.</p>
<p><code>FileSystemXmlApplicationContext</code>: loads the definations of the beans from <code>xml</code> file. Note you need to provide <em>full path</em> of xml bean configuration file path. Example:</p>
<pre class="code literal-block"><span></span><span class="c1">//Use same xml example as above</span>

<span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemXmlApplicationContext</span><span class="o">(</span><span class="s">"C:/Users/pshan/workspace/Sample/Beans.xml"</span><span class="o">);</span> <span class="c1">//You need full path here</span>

<span class="n">helloWorld</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span> <span class="c1">//Use casting here</span>

<span class="n">obj</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span> <span class="c1">//return message in getter (i.e, property in xml), which is Hello World!</span>
</pre>


<p><code>ClassPathXmlApplicationContext</code>: example is in <code>BeanFactory Container</code>. You <em>do not</em> need <em>full</em> path of xml file but you need <em>Class Path</em> to let spring find xml configuration file.</p>
<p><code>WebXmlApplicationContext</code>: loads all beans with in a <code>web</code> application from xml.</p>
<h2>Chapter 6: Spring Bean Definition</h2>
<p><code>Beans</code> are <em>objects</em> that are initialized, assembled, and otherwise managed by Spring IoC <em>Container</em>. They are created with the <code>configuration metadata</code> that supplied by <code>&lt;bean/&gt;</code> defination from <code>xml</code> file.</p>
<p><code>Configuration MetaData</code> provide following:</p>
<ul>
<li>
<p>How to <em>create</em> a bean</p>
</li>
<li>
<p>Bean's <em>lifecycle</em> details</p>
</li>
<li>
<p>Bean's <em>dependencies</em></p>
</li>
</ul>
<h3>Bean Properties</h3>
<p><code>class</code>: mandatory. Give the java class that is used to create beans.</p>
<p><code>name</code>: specifies the bean <code>identifier</code> uniquely. In an <code>xml</code>, you need <code>id</code> and/or <code>name</code> to specify the bean identifiers.</p>
<p><code>scope</code>: specifies bean <em>scope</em>. See notes in chapter 7.</p>
<p><code>constructor-arg</code>: for inject the dependencies. See notes in chapter 8</p>
<p><code>properties</code>:  for inject the dependencies. See notes in chapter 8</p>
<p><code>autowiring mode</code>:  for inject the dependencies. See notes in chapter 8</p>
<p><code>lazy-initialization mode</code>: tells the IoC container to create a bean instance when it is <em>firstly requested</em>, rather than at <em>startup</em>.</p>
<p><code>initialization method</code>: a <code>callback</code> to be called just after all <code>properties</code> for the bean have been set by container. See notes in Chapter 8.</p>
<p><code>destruction method</code>: a <code>callback</code> to be used when the <code>container</code> containing the bean is <em>destroyed</em>. See notes in chaper 8.</p>
<p><code>Configuration Metadata</code> can be provided by:</p>
<ul>
<li>
<p><code>xml</code> based configuration file.</p>
</li>
<li>
<p><code>Annotation-based</code> configuration</p>
</li>
<li>
<p><code>Java-based</code> configuration</p>
</li>
</ul>
<p _="%" images_posts_spring-configuration-metadata.png="images/posts/spring-configuration-metadata.png" img>Example of Bean Properties from book:</p>
<h2>Chapter 7: Spring Bean Scopes</h2>
<p>You can declaring <em>scope</em> of beans when you creates <code>&lt;bean/&gt;</code> in xml file. There are five scopes that Spring support:</p>
<p><code>singleton</code>: <em>Default</em>. Spring IoC container cretes <em>exactly one</em> instance of the object defined by that bean defination. This object is stored in a <em>cache</em> of such singletion beans. A request will return the cached object. Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="c">&lt;!--beans.xml--&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"helloWorld"</span> <span class="na">class=</span><span class="s">"com.sample.helloWorld"</span> <span class="na">scope=</span><span class="s">"singleton"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

<span class="n">helloWorld</span> <span class="n">objA</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span> <span class="c1">//get from bean id and cast it</span>

<span class="n">objA</span><span class="o">.</span><span class="na">setMessage</span> <span class="o">=</span> <span class="s">"testA"</span><span class="o">;</span>

<span class="n">helloWorld</span> <span class="n">objB</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">prinlnt</span><span class="o">(</span><span class="n">objB</span><span class="o">.</span><span class="na">getMessage</span><span class="o">);</span> <span class="c1">//print out "testA" since objA and objB are pointing to same bean instance</span>
</pre>


<p><code>prototype</code>: create new bean instance of object <em>every time</em> a <em>request</em> for the specific bean is made.</p>
<p><em>As a rule, use the prototype scope for all</em> <strong>state-full</strong> <em>beans and the singleton scope for</em> <strong>stateless</strong> <em>beans</em>.</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we have same xml as above</span>

<span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

<span class="n">helloWorld</span> <span class="n">objA</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>

<span class="n">objA</span><span class="o">.</span><span class="na">setMessage</span> <span class="o">=</span> <span class="s">"testA"</span><span class="o">;</span>
<span class="n">objA</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span> <span class="c1">// "testA"</span>

<span class="n">helloWorld</span> <span class="n">objB</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>

<span class="n">objB</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span> <span class="c1">//null. Becuase this is a new request and a new instance is created</span>
</pre>


<h2>Chapter 8: Spring Bean Life Cycle</h2>
<p>In java, <code>initialization</code> work can be done inside <code>afterPropertiesSet()</code> method.</p>
<p>In xml, you can use <code>init-method</code> attribute to call a self-defined method when a bean instance is created. Then add this method in your bean java class.</p>
<p>Similarly, <code>destruction</code> can be done insdie <code>destory()</code> method.
In xml, you can use <code>destroy-method</code> attribute to call a self-defined method. You need to add this method in your bean java class.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"helloWorld"</span> <span class="na">class=</span><span class="s">"com.sample.helloWorld"</span> <span class="na">init-method =</span> <span class="s">"init"</span> <span class="na">destory-method=</span><span class="s">"destroy"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">value=</span><span class="s">"hello World!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//This is the bean class defined in java: com.sample.helloWorld</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">helloWorld</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span> <span class="c1">//The value of message is defined in xml</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getMessage</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(){</span>
    <span class="c1">//This is the initialization method</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"create bean"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">(){</span>
    <span class="c1">//This is the destroy method</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"destory bean"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Now we test it</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">AbstractApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

        <span class="n">helloWorld</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>
        <span class="n">obj</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="n">context</span><span class="o">.</span><span class="na">registerShutdownHook</span><span class="o">();</span> <span class="c1">//shutdown if you are in a desktop-application</span>

        <span class="c1">//Output: create bean | hello World ! | destroy bean</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>You can also put <code>default-init-method</code> and <code>defalut-destory-method</code> attributes in the main bean in <code>xml</code> file, such as <code>&lt;bean xmlns="..." xmlns:xsi="..."&gt;&lt;/bean&gt;</code>, to let all beans use same initialization method or destruction method.</p>
<h2>Chapter 9: Spring Bean Post Processors</h2>
<p><code>BeanPostProcessor</code> <em>interface</em> defines <strong>callback</strong> methods that you can implement to provide your own instantiation logic, dependency-resolution logic, etc.</p>
<p>You can configure multiple BeanPostProcess interfaces. You can control the <em>order</em> of them.</p>
<p>Spring IoC container <em>instantiates</em> a bean instance and then BeanPostProcessor works.</p>
<p>An <code>ApplicationContext</code> automatically detect beans with BeanPostProcessor implementation and register these beans as post-processors. These processors will be automatcally called when bean is created.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"helloWorld"</span> <span class="na">class=</span><span class="s">"com.sample.helloWorld"</span> <span class="na">init-method=</span><span class="s">"init"</span> <span class="na">destroy-method=</span><span class="s">"destroy"</span><span class="nt">&gt;</span>
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">value=</span><span class="s">"Hello World!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!--bean with BeanPostProcessor--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.sample.InitHelloWorld"</span><span class="nt">/&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Bean Class is defined as example in chapter 8</span>

<span class="c1">//Class for BeanPostProcessor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InitHelloWorld</span> <span class="kd">implements</span> <span class="n">BeanPostProcessor</span><span class="o">{</span>
    <span class="c1">//This should be called before bean is initialized</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessBeforeInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Before Init!"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span> <span class="c1">//Any object can be returned</span>
    <span class="o">}</span>
    <span class="c1">//This should be called after bean is initialized</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessAfterInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After Init!"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span> <span class="c1">//Any object can be returned</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//Test Class</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="kd">static</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">AbstractApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

        <span class="n">helloWorld</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">helloWorld</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"helloWorld"</span><span class="o">);</span>
        <span class="n">obj</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
        <span class="n">context</span><span class="o">.</span><span class="na">registerShutdownHook</span><span class="o">();</span>

        <span class="c1">//Output: Before Init!</span>
        <span class="c1">//create bean</span>
        <span class="c1">//After Init!</span>
        <span class="c1">//Hello World!</span>
        <span class="c1">//destry bean</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<h2>Chapter 10: Spring Bean Definition Inheritance**</h2>
<p>A <code>parent bean</code> can be inherited by a <code>child bean</code>. Child bean can <em>override</em> parent bean's attributes.</p>
<p><code>parent</code> attribute should be used in <code>xml</code> file to define a parent bean in child bean.</p>
<p>Example:</p>
<p>XML:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"parentBean"</span> <span class="na">class=</span><span class="s">"com.sample.parentBean"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message1"</span> <span class="na">value=</span><span class="s">"Parent Message 1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message2"</span> <span class="na">value=</span><span class="s">"Parent Message 2"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"childBean"</span> <span class="na">class=</span><span class="s">"com.sample.childBean"</span> <span class="na">parent=</span><span class="s">"parentBean"</span><span class="nt">&gt;</span> <span class="c">&lt;!--note we find parent bean id here--&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message1"</span> <span class="na">value=</span><span class="s">"Child Message1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message3"</span> <span class="na">value=</span><span class="s">"Child Message3"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>


<p>JAVA:</p>
<pre class="code literal-block"><span></span><span class="c1">//Assume we have a normal setter and getter for both parent and child bean</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="kd">static</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"beans.xml"</span><span class="o">);</span>

        <span class="n">parentBean</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="n">parentBean</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="err">'</span><span class="n">parentBean</span><span class="err">'</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">getMessage1</span><span class="o">();</span> <span class="c1">//Parent Message 1</span>
        <span class="n">p</span><span class="o">.</span><span class="na">getMessage2</span><span class="o">();</span> <span class="c1">//Parent Message 2</span>

        <span class="n">childBean</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">childBean</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="err">'</span><span class="n">childBean</span><span class="err">'</span><span class="o">);</span>
        <span class="n">c</span><span class="o">.</span><span class="na">getMessage1</span><span class="o">();</span>
        <span class="c1">//Child Message 1: Override attribute from parent bean</span>
        <span class="n">c</span><span class="o">.</span><span class="na">getMessage2</span><span class="o">();</span>
        <span class="c1">//Parent Message 2: Important! c inherient property from parent bean, so it will not output null value.</span>
        <span class="c1">//However c still need getter and setter for message 2</span>
        <span class="n">c</span><span class="o">.</span><span class="na">getMessage3</span><span class="o">();</span>
        <span class="c1">//Child Message 3: child bean can define its own property</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>You can create <code>Bean Defination Template</code> in <code>xml</code> file if you need a general parent bean for all childs beans. You <em>can not</em> use <code>class</code> attribue in bean template. You <em>must</em> define <code>abstruct</code> attribute as <strong>true</strong>. Example:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"templateBean"</span> <span class="na">abstruct=</span><span class="s">"true"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--template bean can not be instantiated since it is abstract--&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message1"</span> <span class="na">value=</span><span class="s">"template 1!"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message2"</span> <span class="na">value=</span><span class="s">"template 2"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"childBean"</span> <span class="na">class=</span><span class="s">"com.sample.childBean"</span> <span class="na">parent=</span><span class="s">"templateBean"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message1"</span> <span class="na">value=</span><span class="s">"child 1!"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"message3"</span> <span class="na">value=</span><span class="s">"child 3!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre>
</div>
            </div>
        </div>
            <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-3.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="pengyinsnotes";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2016         <a href="mailto:shanpy901115@gmail.com">Pengyin Shan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
